# èª¿å­è¨˜éŒ²ã‚¢ãƒ—ãƒª ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆå®šç¾©æ›¸

## ç›®æ¬¡

1. [ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦](#1-ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦)
2. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#2-æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
3. [ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#3-ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
4. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ](#4-ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ)
5. [APIè¨­è¨ˆ](#5-apiè¨­è¨ˆ)
6. [ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æ§‹é€ ](#6-ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æ§‹é€ )
7. [ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æ§‹é€ ](#7-ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æ§‹é€ )
8. [èªè¨¼ãƒ»èªå¯](#8-èªè¨¼èªå¯)
9. [å¤–éƒ¨APIé€£æº](#9-å¤–éƒ¨apié€£æº)
10. [ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼](#10-ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼)
11. [ä¸»è¦æ©Ÿèƒ½è©³ç´°](#11-ä¸»è¦æ©Ÿèƒ½è©³ç´°)
12. [å®Ÿè£…çŠ¶æ³ã¨èª²é¡Œ](#12-å®Ÿè£…çŠ¶æ³ã¨èª²é¡Œ)

---

## 1. ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### 1.1 ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å
**Mood Tracker - AIã‚’æ´»ç”¨ã—ãŸèª¿å­è¨˜éŒ²ã‚¢ãƒ—ãƒª**

### 1.2 ç›®çš„
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ—¥ã€…ã®èª¿å­ã‚’è¨˜éŒ²ã—ã€AIã«ã‚ˆã‚‹åˆ†æã¨ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’å—ã‘ã‚‹ã“ã¨ã§ã€è‡ªå·±ç†è§£ã‚’æ·±ã‚ã€ã‚ˆã‚Šè‰¯ã„ç”Ÿæ´»ç¿’æ…£ã‚’æ§‹ç¯‰ã™ã‚‹ã“ã¨ã‚’æ”¯æ´ã™ã‚‹Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚

### 1.3 ä¸»è¦æ©Ÿèƒ½
- ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ï¼ˆç™»éŒ²ãƒ»ãƒ­ã‚°ã‚¤ãƒ³ï¼‰
- èª¿å­ãƒ‡ãƒ¼ã‚¿ã®è¨˜éŒ²ï¼ˆä½“èª¿ã€æ°—åˆ†ã€æ´»å‹•å†…å®¹ãªã©ï¼‰
- è‡ªå·±åˆ†æè³ªå•ã¸ã®å›ç­”ï¼ˆ10æ®µéšè©•ä¾¡ï¼‰
- æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã®è‡ªå‹•å–å¾—ãƒ»è¨˜éŒ²
- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã®ãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–ï¼ˆã‚°ãƒ©ãƒ•è¡¨ç¤ºï¼‰
- è¨˜éŒ²ã®ä¸€è¦§è¡¨ç¤ºãƒ»è©³ç´°è¡¨ç¤º
- AIã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿åˆ†æã¨ã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”Ÿæˆ

### 1.4 ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼
è‡ªå·±ç®¡ç†ã‚’è¡Œã„ãŸã„å€‹äººãƒ¦ãƒ¼ã‚¶ãƒ¼

---

## 2. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### 2.1 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
| æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |
|------|-----------|------|
| React | 18.x | UIãƒ©ã‚¤ãƒ–ãƒ©ãƒª |
| TypeScript | 5.x | å‹å®‰å…¨ãªé–‹ç™º |
| Vite | 5.x | ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«ãƒ»é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ |
| Axios | 1.x | HTTPé€šä¿¡ |
| Chart.js | 4.x | ãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ– |
| React Icons | 5.x | ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤º |

### 2.2 ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
| æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |
|------|-----------|------|
| Node.js | 20.x LTS | ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ç’°å¢ƒ |
| Express | 4.x | Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ |
| TypeScript | 5.x | å‹å®‰å…¨ãªé–‹ç™º |
| pg (node-postgres) | 8.x | PostgreSQLã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ |
| bcrypt | 5.x | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ– |
| jsonwebtoken | 9.x | JWTèªè¨¼ |
| express-validator | 7.x | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ |
| dotenv | 16.x | ç’°å¢ƒå¤‰æ•°ç®¡ç† |

### 2.3 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
| æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |
|------|-----------|------|
| PostgreSQL | 16.x | ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ |

### 2.4 å¤–éƒ¨API
| ã‚µãƒ¼ãƒ“ã‚¹ | ç”¨é€” |
|---------|------|
| Google Gemini API | AIåˆ†æãƒ»ã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”Ÿæˆ |
| WeatherAPI | æ°—è±¡ãƒ‡ãƒ¼ã‚¿å–å¾— |

### 2.5 é–‹ç™ºç’°å¢ƒ
| ãƒ„ãƒ¼ãƒ« | ç”¨é€” |
|--------|------|
| VSCode | ã‚¨ãƒ‡ã‚£ã‚¿ |
| Git | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç† |
| npm | ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç† |

---

## 3. ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 3.1 å…¨ä½“æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ãƒ–ãƒ©ã‚¦ã‚¶      â”‚
â”‚   (React)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ HTTP/HTTPS
         â”‚ (REST API)
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Express Server  â”‚
â”‚   (Node.js)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         â”‚            â”‚
    â”‚         â”‚            â”‚
â”Œâ”€â”€â”€â”´â”€â”€â”€â” â”Œâ”€â”€â”´â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚PostgreSQLâ”‚ â”‚Gemini APIâ”‚ â”‚WeatherAPIâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³
- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ™ãƒ¼ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: MVCï¼ˆModel-View-Controllerï¼‰ãƒ‘ã‚¿ãƒ¼ãƒ³
- **é€šä¿¡**: RESTful API
- **èªè¨¼**: JWTï¼ˆJSON Web Tokenï¼‰ãƒ™ãƒ¼ã‚¹

### 3.3 ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹æˆ

#### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
```
Presentation Layer (Components)
        â†“
Service Layer (API Clients)
        â†“
HTTP Client (Axios)
```

#### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
```
Route Layer (ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)
        â†“
Controller Layer (ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯)
        â†“
Model Layer (ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹)
        â†“
Database (PostgreSQL)
```

---

## 4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### 4.1 ERå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    users     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1
       â”‚
       â”‚ N
â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
â”‚   records    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                     â”‚
       â”‚ N                   â”‚ N
â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚analysis_answers â”‚  â”‚  weather_data  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ N
       â”‚
       â”‚ 1
â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚analysis_questions   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ N
       â”‚
       â”‚ 1
â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚analysis_categories  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    users     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1
       â”‚
       â”‚ N
â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚advice_history    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©

#### 4.2.1 usersï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ï¼‰

| ã‚«ãƒ©ãƒ å | ãƒ‡ãƒ¼ã‚¿å‹ | åˆ¶ç´„ | èª¬æ˜ |
|---------|---------|------|------|
| id | SERIAL | PRIMARY KEY | ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆè‡ªå‹•æ¡ç•ªï¼‰ |
| username | VARCHAR(50) | UNIQUE NOT NULL | ãƒ¦ãƒ¼ã‚¶ãƒ¼å |
| email | VARCHAR(255) | UNIQUE NOT NULL | ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ |
| password_hash | VARCHAR(255) | NOT NULL | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥å€¤ |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | ä½œæˆæ—¥æ™‚ |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | æ›´æ–°æ—¥æ™‚ |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**: ãªã—ï¼ˆPRIMARY KEYã¨UNIQUEåˆ¶ç´„ã«ã‚ˆã‚Šè‡ªå‹•ä½œæˆï¼‰

---

#### 4.2.2 recordsï¼ˆè¨˜éŒ²ãƒ‡ãƒ¼ã‚¿ï¼‰

| ã‚«ãƒ©ãƒ å | ãƒ‡ãƒ¼ã‚¿å‹ | åˆ¶ç´„ | èª¬æ˜ |
|---------|---------|------|------|
| id | SERIAL | PRIMARY KEY | è¨˜éŒ²IDï¼ˆè‡ªå‹•æ¡ç•ªï¼‰ |
| user_id | INTEGER | NOT NULL, REFERENCES users(id) ON DELETE CASCADE | ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |
| recorded_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | è¨˜éŒ²æ—¥æ™‚ |
| sleep_hours | DECIMAL(3,1) | NULL | ç¡çœ æ™‚é–“ï¼ˆæ™‚é–“ï¼‰ |
| sleep_quality | INTEGER | CHECK (1ï½10), NULL | ç¡çœ ã®è³ªï¼ˆ10æ®µéšï¼‰ |
| meal_quality | INTEGER | CHECK (1ï½10), NULL | é£Ÿäº‹ã®è³ªï¼ˆ10æ®µéšï¼‰ |
| meal_regularity | INTEGER | CHECK (1ï½10), NULL | é£Ÿäº‹ã®è¦å‰‡æ€§ï¼ˆ10æ®µéšï¼‰ |
| exercise_minutes | INTEGER | NULL | é‹å‹•æ™‚é–“ï¼ˆåˆ†ï¼‰ |
| exercise_intensity | INTEGER | CHECK (1ï½10), NULL | é‹å‹•å¼·åº¦ï¼ˆ10æ®µéšï¼‰ |
| emotion_score | INTEGER | CHECK (1ï½10), NULL | æ„Ÿæƒ…ã‚¹ã‚³ã‚¢ï¼ˆ10æ®µéšï¼‰ |
| emotion_note | TEXT | NULL | æ„Ÿæƒ…ã«é–¢ã™ã‚‹ãƒ¡ãƒ¢ |
| motivation_score | INTEGER | CHECK (1ï½10), NULL | ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ10æ®µéšï¼‰ |
| activities_done | TEXT | NULL | ã‚„ã£ãŸã“ã¨ï¼ˆè‡ªç”±è¨˜è¿°ï¼‰ |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | ä½œæˆæ—¥æ™‚ |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | æ›´æ–°æ—¥æ™‚ |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**:
- `idx_records_user_id` ON (user_id)
- `idx_records_recorded_at` ON (recorded_at)

---

#### 4.2.3 analysis_categoriesï¼ˆåˆ†æè¦³ç‚¹ãƒã‚¹ã‚¿ï¼‰

| ã‚«ãƒ©ãƒ å | ãƒ‡ãƒ¼ã‚¿å‹ | åˆ¶ç´„ | èª¬æ˜ |
|---------|---------|------|------|
| id | SERIAL | PRIMARY KEY | è¦³ç‚¹IDï¼ˆè‡ªå‹•æ¡ç•ªï¼‰ |
| code | VARCHAR(50) | UNIQUE NOT NULL | è¦³ç‚¹ã‚³ãƒ¼ãƒ‰ |
| name | VARCHAR(100) | NOT NULL | è¦³ç‚¹åç§° |
| description | TEXT | NULL | èª¬æ˜ |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | ä½œæˆæ—¥æ™‚ |

**åˆæœŸãƒ‡ãƒ¼ã‚¿**:
- code='stress', name='ã‚¹ãƒˆãƒ¬ã‚¹'
- code='concentration', name='é›†ä¸­åŠ›'
- code='motivation', name='ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³'

---

#### 4.2.4 analysis_questionsï¼ˆè³ªå•ãƒã‚¹ã‚¿ï¼‰

| ã‚«ãƒ©ãƒ å | ãƒ‡ãƒ¼ã‚¿å‹ | åˆ¶ç´„ | èª¬æ˜ |
|---------|---------|------|------|
| id | SERIAL | PRIMARY KEY | è³ªå•IDï¼ˆè‡ªå‹•æ¡ç•ªï¼‰ |
| category_id | INTEGER | NOT NULL, REFERENCES analysis_categories(id) ON DELETE CASCADE | åˆ†æè¦³ç‚¹ID |
| question_text | TEXT | NOT NULL | è³ªå•æ–‡ |
| is_active | BOOLEAN | DEFAULT true | æœ‰åŠ¹ãƒ•ãƒ©ã‚° |
| generated_by_ai | BOOLEAN | DEFAULT false | AIç”Ÿæˆãƒ•ãƒ©ã‚° |
| usage_count | INTEGER | DEFAULT 0 | ä½¿ç”¨å›æ•° |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | ä½œæˆæ—¥æ™‚ |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**:
- `idx_questions_category_id` ON (category_id)
- `idx_questions_is_active` ON (is_active)

---

#### 4.2.5 analysis_answersï¼ˆå›ç­”ãƒ‡ãƒ¼ã‚¿ï¼‰

| ã‚«ãƒ©ãƒ å | ãƒ‡ãƒ¼ã‚¿å‹ | åˆ¶ç´„ | èª¬æ˜ |
|---------|---------|------|------|
| id | SERIAL | PRIMARY KEY | å›ç­”IDï¼ˆè‡ªå‹•æ¡ç•ªï¼‰ |
| user_id | INTEGER | NOT NULL, REFERENCES users(id) ON DELETE CASCADE | ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |
| record_id | INTEGER | REFERENCES records(id) ON DELETE CASCADE, NULL | è¨˜éŒ²IDï¼ˆä»»æ„ï¼‰ |
| question_id | INTEGER | NOT NULL, REFERENCES analysis_questions(id) ON DELETE CASCADE | è³ªå•ID |
| answer_score | INTEGER | NOT NULL, CHECK (1ï½10) | å›ç­”ã‚¹ã‚³ã‚¢ï¼ˆ10æ®µéšï¼‰ |
| answered_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | å›ç­”æ—¥æ™‚ |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**:
- `idx_answers_user_id` ON (user_id)
- `idx_answers_record_id` ON (record_id)
- `idx_answers_question_id` ON (question_id)
- `idx_answers_answered_at` ON (answered_at)

---

#### 4.2.6 weather_dataï¼ˆæ°—è±¡ãƒ‡ãƒ¼ã‚¿ï¼‰

| ã‚«ãƒ©ãƒ å | ãƒ‡ãƒ¼ã‚¿å‹ | åˆ¶ç´„ | èª¬æ˜ | å®Ÿè£…çŠ¶æ³ |
|---------|---------|------|------|---------|
| id | SERIAL | PRIMARY KEY | æ°—è±¡ãƒ‡ãƒ¼ã‚¿IDï¼ˆè‡ªå‹•æ¡ç•ªï¼‰ | âœ… å®Ÿè£…æ¸ˆã¿ |
| user_id | INTEGER | NOT NULL, REFERENCES users(id) ON DELETE CASCADE | ãƒ¦ãƒ¼ã‚¶ãƒ¼ID | âœ… å®Ÿè£…æ¸ˆã¿ |
| recorded_at | TIMESTAMP | NOT NULL | è¨˜éŒ²æ—¥æ™‚ | âœ… å®Ÿè£…æ¸ˆã¿ |
| temperature | DECIMAL(4,1) | NULL | æ°—æ¸©ï¼ˆâ„ƒï¼‰ | âœ… å®Ÿè£…æ¸ˆã¿ |
| humidity | INTEGER | NULL | æ¹¿åº¦ï¼ˆ%ï¼‰ | âœ… å®Ÿè£…æ¸ˆã¿ |
| pressure | DECIMAL(6,2) | NULL | æ°—åœ§ï¼ˆhPaï¼‰ | âš ï¸ æœªä½¿ç”¨ |
| weather_condition | VARCHAR(100) | NULL | å¤©æ°—ã®çŠ¶æ…‹ | âœ… å®Ÿè£…æ¸ˆã¿ |
| weather_description | TEXT | NULL | è©³ç´°ãªå¤©æ°—èª¬æ˜ | âš ï¸ æœªä½¿ç”¨ |
| season | VARCHAR(20) | NULL | å­£ç¯€ | âš ï¸ æœªä½¿ç”¨ |
| location | VARCHAR(255) | NULL | ä½ç½®æƒ…å ± | âœ… å®Ÿè£…æ¸ˆã¿ï¼ˆ'Tokyo'å›ºå®šï¼‰ |
| api_source | VARCHAR(50) | NULL | ãƒ‡ãƒ¼ã‚¿å–å¾—å…ƒAPI | âš ï¸ æœªä½¿ç”¨ |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | ä½œæˆæ—¥æ™‚ | âœ… å®Ÿè£…æ¸ˆã¿ |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**:
- `idx_weather_user_id` ON (user_id)
- `idx_weather_recorded_at` ON (recorded_at)

**å®Ÿè£…ãƒ¡ãƒ¢**:
- å®Ÿéš›ã«ä¿å­˜ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿: user_id, temperature, humidity, weather_condition, location, recorded_at
- pressure, weather_description, season, api_source ã¯ç¾åœ¨æœªä½¿ç”¨
- location ã¯ 'Tokyo' ã§å›ºå®šï¼ˆä»Šå¾Œã®æ”¹å–„å€™è£œï¼‰

---

#### 4.2.7 advice_historyï¼ˆã‚¢ãƒ‰ãƒã‚¤ã‚¹å±¥æ­´ï¼‰

| ã‚«ãƒ©ãƒ å | ãƒ‡ãƒ¼ã‚¿å‹ | åˆ¶ç´„ | èª¬æ˜ |
|---------|---------|------|------|
| id | SERIAL | PRIMARY KEY | ã‚¢ãƒ‰ãƒã‚¤ã‚¹IDï¼ˆè‡ªå‹•æ¡ç•ªï¼‰ |
| user_id | INTEGER | NOT NULL, REFERENCES users(id) ON DELETE CASCADE | ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |
| advice_text | TEXT | NOT NULL | ã‚¢ãƒ‰ãƒã‚¤ã‚¹æœ¬æ–‡ |
| advice_type | VARCHAR(50) | NULL | ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã®ç¨®é¡ |
| based_on_data | JSONB | NULL | ç”Ÿæˆã«ä½¿ç”¨ã—ãŸãƒ‡ãƒ¼ã‚¿ |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | ä½œæˆæ—¥æ™‚ |
| displayed_at | TIMESTAMP | NULL | è¡¨ç¤ºæ—¥æ™‚ |
| was_helpful | BOOLEAN | NULL | å½¹ç«‹ã£ãŸã‹ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**:
- `idx_advice_user_id` ON (user_id)
- `idx_advice_created_at` ON (created_at)

---

### 4.3 ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—

#### ä¸»è¦ãªé–¢ä¿‚æ€§

1. **users â†’ records**: 1å¯¾å¤šï¼ˆ1ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è¤‡æ•°ã®è¨˜éŒ²ã‚’æŒã¤ï¼‰
2. **users â†’ analysis_answers**: 1å¯¾å¤šï¼ˆ1ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è¤‡æ•°ã®å›ç­”ã‚’æŒã¤ï¼‰
3. **users â†’ weather_data**: 1å¯¾å¤šï¼ˆ1ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è¤‡æ•°ã®æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã‚’æŒã¤ï¼‰
4. **users â†’ advice_history**: 1å¯¾å¤šï¼ˆ1ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è¤‡æ•°ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’å—ã‘ã‚‹ï¼‰
5. **analysis_categories â†’ analysis_questions**: 1å¯¾å¤šï¼ˆ1è¦³ç‚¹ã¯è¤‡æ•°ã®è³ªå•ã‚’æŒã¤ï¼‰
6. **analysis_questions â†’ analysis_answers**: 1å¯¾å¤šï¼ˆ1è³ªå•ã¯è¤‡æ•°ã®å›ç­”ã‚’æŒã¤ï¼‰
7. **records â†’ analysis_answers**: 1å¯¾å¤šï¼ˆ1è¨˜éŒ²ã¯è¤‡æ•°ã®å›ç­”ã‚’æŒã¤ã€ä»»æ„ï¼‰

#### CASCADEå‰Šé™¤ã®è¨­è¨ˆæ€æƒ³

- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå‰Šé™¤ã•ã‚ŒãŸå ´åˆã€ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç´ã¥ãå…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ï¼ˆ`ON DELETE CASCADE`ï¼‰
- ãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ã‚’ä¿ã¤ãŸã‚ã€è¦ªã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®å‰Šé™¤æ™‚ã«å­ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚‚è‡ªå‹•å‰Šé™¤

---

## 5. APIè¨­è¨ˆ

### 5.1 APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§

#### èªè¨¼é–¢é€£

| ãƒ¡ã‚½ãƒƒãƒ‰ | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | èªè¨¼ | èª¬æ˜ | å®Ÿè£…çŠ¶æ³ |
|---------|--------------|------|------|---------|
| POST | /api/auth/register | ä¸è¦ | ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ² | âœ… å®Ÿè£…æ¸ˆã¿ |
| POST | /api/auth/login | ä¸è¦ | ãƒ­ã‚°ã‚¤ãƒ³ | âœ… å®Ÿè£…æ¸ˆã¿ |
| GET | /api/auth/me | å¿…è¦ | ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾— | âœ… å®Ÿè£…æ¸ˆã¿ |

#### è¨˜éŒ²é–¢é€£

| ãƒ¡ã‚½ãƒƒãƒ‰ | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | èªè¨¼ | èª¬æ˜ | å®Ÿè£…çŠ¶æ³ |
|---------|--------------|------|------|---------|
| GET | /api/records | å¿…è¦ | è¨˜éŒ²ä¸€è¦§å–å¾— | âœ… å®Ÿè£…æ¸ˆã¿ |
| GET | /api/records/:id | å¿…è¦ | ç‰¹å®šã®è¨˜éŒ²å–å¾— | âœ… å®Ÿè£…æ¸ˆã¿ |
| POST | /api/records | å¿…è¦ | è¨˜éŒ²ä½œæˆï¼ˆæ°—è±¡ãƒ‡ãƒ¼ã‚¿è‡ªå‹•ä¿å­˜ï¼‰ | âœ… å®Ÿè£…æ¸ˆã¿ |
| PUT | /api/records/:id | å¿…è¦ | è¨˜éŒ²æ›´æ–° | âœ… å®Ÿè£…æ¸ˆã¿ |
| DELETE | /api/records/:id | å¿…è¦ | è¨˜éŒ²å‰Šé™¤ | âœ… å®Ÿè£…æ¸ˆã¿ |
| GET | /api/records/stats | å¿…è¦ | çµ±è¨ˆæƒ…å ±å–å¾— | âœ… å®Ÿè£…æ¸ˆã¿ |
| GET | /api/records/chart | å¿…è¦ | ã‚°ãƒ©ãƒ•ãƒ‡ãƒ¼ã‚¿å–å¾— | âœ… å®Ÿè£…æ¸ˆã¿ |

#### åˆ†æé–¢é€£

| ãƒ¡ã‚½ãƒƒãƒ‰ | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | èªè¨¼ | èª¬æ˜ | å®Ÿè£…çŠ¶æ³ |
|---------|--------------|------|------|---------|
| GET | /api/analysis/categories | å¿…è¦ | åˆ†æè¦³ç‚¹ä¸€è¦§å–å¾— | âš ï¸ æœªç¢ºèª |
| GET | /api/analysis/questions | å¿…è¦ | è³ªå•ä¸€è¦§å–å¾— | âš ï¸ æœªç¢ºèª |
| POST | /api/analysis/answers | å¿…è¦ | å›ç­”ä¿å­˜ | âš ï¸ æœªç¢ºèª |

#### æ°—è±¡ãƒ‡ãƒ¼ã‚¿é–¢é€£

| ãƒ¡ã‚½ãƒƒãƒ‰ | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | èªè¨¼ | èª¬æ˜ | å®Ÿè£…çŠ¶æ³ |
|---------|--------------|------|------|---------|
| GET | /api/weather/current | å¿…è¦ | ç¾åœ¨ã®æ°—è±¡ãƒ‡ãƒ¼ã‚¿å–å¾— | âœ… å®Ÿè£…æ¸ˆã¿ |
| GET | /api/weather/record/:recordId | å¿…è¦ | è¨˜éŒ²ã«ç´ã¥ãæ°—è±¡ãƒ‡ãƒ¼ã‚¿å–å¾— | âŒ æœªå®Ÿè£… |

---

### 5.2 APIãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹è©³ç´°

#### 5.2.1 ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
```http
POST /api/auth/register
Content-Type: application/json

{
  "username": "testuser",
  "email": "test@example.com",
  "password": "password123"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆæˆåŠŸï¼‰**
```json
{
  "success": true,
  "data": {
    "user": {
      "id": 1,
      "username": "testuser",
      "email": "test@example.com"
    },
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  },
  "message": "ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸ"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆã‚¨ãƒ©ãƒ¼ï¼‰**
```json
{
  "success": false,
  "message": "æ—¢ã«å­˜åœ¨ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼åã§ã™"
}
```

---

#### 5.2.2 ãƒ­ã‚°ã‚¤ãƒ³

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
```http
POST /api/auth/login
Content-Type: application/json

{
  "username": "testuser",
  "password": "password123"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆæˆåŠŸï¼‰**
```json
{
  "success": true,
  "data": {
    "user": {
      "id": 1,
      "username": "testuser",
      "email": "test@example.com"
    },
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  },
  "message": "ãƒ­ã‚°ã‚¤ãƒ³ã«æˆåŠŸã—ã¾ã—ãŸ"
}
```

---

#### 5.2.3 è¨˜éŒ²ä½œæˆ

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
```http
POST /api/records
Authorization: Bearer {token}
Content-Type: application/json

{
  "sleep_hours": 7.5,
  "sleep_quality": 8,
  "meal_quality": 7,
  "meal_regularity": 8,
  "exercise_minutes": 30,
  "exercise_intensity": 6,
  "emotion_score": 8,
  "emotion_note": "ä»Šæ—¥ã¯æ°—åˆ†ãŒè‰¯ã„",
  "motivation_score": 7,
  "activities_done": "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä½œæˆã—ãŸ"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆæˆåŠŸï¼‰**
```json
{
  "success": true,
  "data": {
    "id": 1,
    "user_id": 1,
    "recorded_at": "2025-11-07T12:00:00.000Z",
    "sleep_hours": 7.5,
    "sleep_quality": 8,
    "meal_quality": 7,
    "meal_regularity": 8,
    "exercise_minutes": 30,
    "exercise_intensity": 6,
    "emotion_score": 8,
    "emotion_note": "ä»Šæ—¥ã¯æ°—åˆ†ãŒè‰¯ã„",
    "motivation_score": 7,
    "activities_done": "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä½œæˆã—ãŸ",
    "created_at": "2025-11-07T12:00:00.000Z",
    "updated_at": "2025-11-07T12:00:00.000Z"
  },
  "message": "è¨˜éŒ²ã‚’ä½œæˆã—ã¾ã—ãŸ"
}
```

**å®Ÿè£…ãƒ¡ãƒ¢**:
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹è¿”å´å¾Œã€éåŒæœŸã§æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ãƒ»ä¿å­˜
- æ°—è±¡ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã‚¨ãƒ©ãƒ¼ã¯è¨˜éŒ²ä½œæˆã«å½±éŸ¿ã—ãªã„

---

#### 5.2.4 çµ±è¨ˆæƒ…å ±å–å¾—

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
```http
GET /api/records/stats
Authorization: Bearer {token}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆæˆåŠŸï¼‰**
```json
{
  "success": true,
  "data": {
    "total_records": 25,
    "this_week_records": 5,
    "avg_emotion_score": 7.5,
    "avg_motivation_score": 6.8,
    "latest_record_date": "2025-11-07T12:00:00.000Z"
  }
}
```

---

#### 5.2.5 ã‚°ãƒ©ãƒ•ãƒ‡ãƒ¼ã‚¿å–å¾—

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
```http
GET /api/records/chart
Authorization: Bearer {token}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆæˆåŠŸï¼‰**
```json
{
  "success": true,
  "data": {
    "mood": [
      {
        "date": "2025-11-01",
        "avg_emotion": 7.5,
        "avg_motivation": 6.8
      },
      {
        "date": "2025-11-02",
        "avg_emotion": 8.0,
        "avg_motivation": 7.2
      }
    ],
    "weather": [
      {
        "date": "2025-11-01",
        "avg_temperature": 18.5,
        "avg_humidity": 65,
        "weather_condition": "Partly cloudy"
      },
      {
        "date": "2025-11-02",
        "avg_temperature": 20.0,
        "avg_humidity": 60,
        "weather_condition": "Sunny"
      }
    ]
  }
}
```

---

#### 5.2.6 è³ªå•ä¸€è¦§å–å¾—

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
```http
GET /api/analysis/questions
Authorization: Bearer {token}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆæˆåŠŸï¼‰**
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "category_id": 1,
      "question_text": "ä»Šæ—¥ã®ã‚¹ãƒˆãƒ¬ã‚¹ãƒ¬ãƒ™ãƒ«ã¯ã©ã®ç¨‹åº¦ã§ã™ã‹ï¼Ÿ",
      "is_active": true,
      "generated_by_ai": false
    },
    {
      "id": 2,
      "category_id": 2,
      "question_text": "ä»Šæ—¥ã®é›†ä¸­åŠ›ã¯ã©ã®ç¨‹åº¦ã§ã—ãŸã‹ï¼Ÿ",
      "is_active": true,
      "generated_by_ai": false
    }
  ]
}
```

---

#### 5.2.7 å›ç­”ä¿å­˜

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
```http
POST /api/analysis/answers
Authorization: Bearer {token}
Content-Type: application/json

{
  "answers": [
    {
      "question_id": 1,
      "answer_score": 7,
      "record_id": 1
    },
    {
      "question_id": 2,
      "answer_score": 8,
      "record_id": 1
    }
  ]
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆæˆåŠŸï¼‰**
```json
{
  "success": true,
  "message": "å›ç­”ã‚’ä¿å­˜ã—ã¾ã—ãŸ"
}
```

---

#### 5.2.8 ç¾åœ¨ã®æ°—è±¡ãƒ‡ãƒ¼ã‚¿å–å¾—

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
```http
GET /api/weather/current?city=Tokyo
Authorization: Bearer {token}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆæˆåŠŸï¼‰**
```json
{
  "success": true,
  "data": {
    "temperature": 18.5,
    "humidity": 65,
    "weatherCondition": "Partly cloudy",
    "location": "Tokyo, Japan"
  }
}
```

**å®Ÿè£…ãƒ¡ãƒ¢**:
- ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ city ã¯ä»»æ„ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: Tokyoï¼‰
- WeatherAPI ã‹ã‚‰å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’è¿”å´

---

#### 5.2.9 è¨˜éŒ²ã«ç´ã¥ãæ°—è±¡ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆæœªå®Ÿè£…ï¼‰

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
```http
GET /api/weather/record/:recordId
Authorization: Bearer {token}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆæˆåŠŸï¼‰- æƒ³å®šä»•æ§˜**
```json
{
  "success": true,
  "data": {
    "temperature": 18.5,
    "humidity": 65,
    "weatherCondition": "Partly cloudy",
    "location": "Tokyo, Japan"
  }
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆã‚¨ãƒ©ãƒ¼ï¼‰- æƒ³å®šä»•æ§˜**
```json
{
  "success": false,
  "message": "è¨˜éŒ²ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ"
}
```

ã¾ãŸã¯

```json
{
  "success": false,
  "message": "æ°—è±¡ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ"
}
```

**å®Ÿè£…äºˆå®šã®å‡¦ç†ãƒ•ãƒ­ãƒ¼**:
1. recordId ã§è¨˜éŒ²ã‚’å–å¾—
2. è¨˜éŒ²ã® recorded_at ã‚’å–å¾—
3. WeatherDataModel.getByUserAndDate() ã§æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
4. æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã‚’è¿”å´

---

### 5.3 ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼

å…¨ã¦ã®APIã‚¨ãƒ©ãƒ¼ã¯ä»¥ä¸‹ã®å½¢å¼ã§è¿”å´ã•ã‚Œã‚‹ã€‚

```json
{
  "success": false,
  "message": "ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"
}
```

**HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰**:
- 200: æˆåŠŸ
- 201: ä½œæˆæˆåŠŸ
- 400: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
- 401: èªè¨¼ã‚¨ãƒ©ãƒ¼
- 404: ãƒªã‚½ãƒ¼ã‚¹ãŒè¦‹ã¤ã‹ã‚‰ãªã„
- 500: ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼

---

## 6. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æ§‹é€ 

### 6.1 ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
mood-tracker-backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ database.ts           # DBæ¥ç¶šè¨­å®š
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ authController.ts     # èªè¨¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼
â”‚   â”‚   â”œâ”€â”€ recordController.ts   # è¨˜éŒ²ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ âœ… æ°—è±¡ãƒ‡ãƒ¼ã‚¿è‡ªå‹•ä¿å­˜å®Ÿè£…æ¸ˆã¿
â”‚   â”‚   â”œâ”€â”€ analysisController.ts # åˆ†æã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼
â”‚   â”‚   â””â”€â”€ weatherController.ts  # æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ âœ… ç¾åœ¨ã®æ°—è±¡ãƒ‡ãƒ¼ã‚¿å–å¾—å®Ÿè£…æ¸ˆã¿
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ User.ts               # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¢ãƒ‡ãƒ«
â”‚   â”‚   â”œâ”€â”€ Record.ts             # è¨˜éŒ²ãƒ¢ãƒ‡ãƒ«
â”‚   â”‚   â”œâ”€â”€ Analysis.ts           # åˆ†æãƒ¢ãƒ‡ãƒ«
â”‚   â”‚   â””â”€â”€ WeatherData.ts        # æ°—è±¡ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ« âœ… create, getByUserAndDate å®Ÿè£…æ¸ˆã¿
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ authRoutes.ts         # èªè¨¼ãƒ«ãƒ¼ãƒˆ
â”‚   â”‚   â”œâ”€â”€ recordRoutes.ts       # è¨˜éŒ²ãƒ«ãƒ¼ãƒˆ
â”‚   â”‚   â”œâ”€â”€ analysisRoutes.ts     # åˆ†æãƒ«ãƒ¼ãƒˆ
â”‚   â”‚   â””â”€â”€ weatherRoutes.ts      # æ°—è±¡ãƒ‡ãƒ¼ã‚¿ãƒ«ãƒ¼ãƒˆ âœ… /current å®Ÿè£…æ¸ˆã¿
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ auth.ts               # èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
â”‚   â”‚   â””â”€â”€ validation.ts         # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ weatherService.ts     # æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã‚µãƒ¼ãƒ“ã‚¹ âœ… getCurrentWeather å®Ÿè£…æ¸ˆã¿
â”‚   â”‚   â””â”€â”€ aiService.ts          # AIã‚µãƒ¼ãƒ“ã‚¹ï¼ˆäºˆå®šï¼‰
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ passwordHelper.ts     # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ˜ãƒ«ãƒ‘ãƒ¼
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â””â”€â”€ index.ts              # TypeScriptå‹å®šç¾©
â”‚   â”œâ”€â”€ scripts/
â”‚   â”‚   â””â”€â”€ migrate.ts            # ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â””â”€â”€ index.ts                  # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ migrations/
â”‚   â”œâ”€â”€ 001_initial_schema.sql    # åˆæœŸã‚¹ã‚­ãƒ¼ãƒ
â”‚   â””â”€â”€ 002_seed_data.sql         # åˆæœŸãƒ‡ãƒ¼ã‚¿
â”œâ”€â”€ .env                          # ç’°å¢ƒå¤‰æ•°
â”œâ”€â”€ .env.example                  # ç’°å¢ƒå¤‰æ•°ã‚µãƒ³ãƒ—ãƒ«
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

### 6.2 ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

#### 6.2.1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šï¼ˆdatabase.tsï¼‰

PostgreSQLã¸ã®æ¥ç¶šãƒ—ãƒ¼ãƒ«ã‚’ç®¡ç†ã€‚

**è²¬å‹™**:
- æ¥ç¶šãƒ—ãƒ¼ãƒ«ã®ä½œæˆã¨ç®¡ç†
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã®æä¾›

**å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³**:
```typescript
import { Pool } from 'pg';

const pool = new Pool({
  host: process.env.DB_HOST,
  port: parseInt(process.env.DB_PORT || '5432'),
  database: process.env.DB_NAME,
  user: process.env.DB_USER,
  password: process.env.DB_PASSWORD,
});

export default pool;
```

---

#### 6.2.2 èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ï¼ˆauth.tsï¼‰

JWTãƒˆãƒ¼ã‚¯ãƒ³ã®æ¤œè¨¼ã‚’è¡Œã†ã€‚

**è²¬å‹™**:
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã‹ã‚‰ãƒˆãƒ¼ã‚¯ãƒ³æŠ½å‡º
- ãƒˆãƒ¼ã‚¯ãƒ³ã®æ¤œè¨¼
- ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¸ã®ä»˜ä¸

**å‡¦ç†ãƒ•ãƒ­ãƒ¼**:
1. Authorizationãƒ˜ãƒƒãƒ€ãƒ¼ã‹ã‚‰ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—
2. JWTæ¤œè¨¼
3. æ¤œè¨¼æˆåŠŸ â†’ req.userã«ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’è¨­å®š
4. æ¤œè¨¼å¤±æ•— â†’ 401ã‚¨ãƒ©ãƒ¼ã‚’è¿”å´

---

#### 6.2.3 ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ï¼ˆvalidation.tsï¼‰

express-validatorã‚’ä½¿ç”¨ã—ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€‚

**è²¬å‹™**:
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®å¦¥å½“æ€§æ¤œè¨¼
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã®åé›†ã¨è¿”å´

**ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«ä¾‹**:
- ãƒ¦ãƒ¼ã‚¶ãƒ¼å: 3æ–‡å­—ä»¥ä¸Šã€50æ–‡å­—ä»¥å†…
- ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹: æœ‰åŠ¹ãªãƒ¡ãƒ¼ãƒ«å½¢å¼
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: 6æ–‡å­—ä»¥ä¸Š
- ã‚¹ã‚³ã‚¢: 1ï½10ã®æ•´æ•°

---

#### 6.2.4 ãƒ¢ãƒ‡ãƒ«å±¤

å„ãƒ†ãƒ¼ãƒ–ãƒ«ã«å¯¾å¿œã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã€‚

**UserModel**:
- findByUsername(): ãƒ¦ãƒ¼ã‚¶ãƒ¼åã§ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢
- findByEmail(): ãƒ¡ãƒ¼ãƒ«ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢
- findById(): IDã§ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢
- create(): ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ

**RecordModel**:
- findByUserId(): ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¨˜éŒ²ä¸€è¦§å–å¾—
- findById(): ç‰¹å®šã®è¨˜éŒ²å–å¾—
- create(): è¨˜éŒ²ä½œæˆ
- update(): è¨˜éŒ²æ›´æ–°
- delete(): è¨˜éŒ²å‰Šé™¤
- getStats(): çµ±è¨ˆæƒ…å ±å–å¾—
- getChartData(): ã‚°ãƒ©ãƒ•ãƒ‡ãƒ¼ã‚¿å–å¾—
- getWeatherChartData(): æ°—è±¡ã‚°ãƒ©ãƒ•ãƒ‡ãƒ¼ã‚¿å–å¾—

**AnalysisModel**:
- getCategories(): åˆ†æè¦³ç‚¹å–å¾—
- getActiveQuestions(): æœ‰åŠ¹ãªè³ªå•å–å¾—
- saveAnswers(): å›ç­”ä¿å­˜

**WeatherDataModel** âœ… å®Ÿè£…ç¢ºèªæ¸ˆã¿:
- create(): æ°—è±¡ãƒ‡ãƒ¼ã‚¿ä¿å­˜
- getByUserAndDate(): æŒ‡å®šæ—¥æ™‚ã®æ°—è±¡ãƒ‡ãƒ¼ã‚¿å–å¾—

**å®Ÿè£…è©³ç´°**:
```typescript
export class WeatherDataModel {
  static async create(
    userId: number,
    temperature: number,
    humidity: number,
    weatherCondition: string,
    location?: string
  ): Promise<WeatherDataRow> {
    const result = await pool.query(
      `INSERT INTO weather_data (user_id, temperature, humidity, weather_condition, location, recorded_at)
       VALUES ($1, $2, $3, $4, $5, NOW())
       RETURNING *`,
      [userId, temperature, humidity, weatherCondition, location]
    );
    return result.rows[0];
  }

  static async getByUserAndDate(userId: number, date: Date): Promise<WeatherDataRow | null> {
    const result = await pool.query(
      `SELECT * FROM weather_data
       WHERE user_id = $1 AND DATE(recorded_at) = DATE($2)
       ORDER BY recorded_at DESC
       LIMIT 1`,
      [userId, date]
    );
    return result.rows[0] || null;
  }
}
```

---

#### 6.2.5 ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼å±¤

ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…ã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”Ÿæˆã€‚

**è²¬å‹™**:
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å—ã‘å–ã‚Š
- ãƒ¢ãƒ‡ãƒ«å±¤ã®å‘¼ã³å‡ºã—
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ç”Ÿæˆ
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

**recordController.ts - æ°—è±¡ãƒ‡ãƒ¼ã‚¿è‡ªå‹•ä¿å­˜ã®å®Ÿè£…**:
```typescript
export async function createRecord(req: Request, res: Response): Promise<void> {
  try {
    const userId = req.user?.userId;
    if (!userId) {
      res.status(401).json({ success: false, message: 'èªè¨¼ãŒå¿…è¦ã§ã™' });
      return;
    }
    
    const recordData: RecordInput = req.body;
    const record = await RecordModel.create(userId, recordData);

    // æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ä¿å­˜ï¼ˆéåŒæœŸã§å®Ÿè¡Œã€ã‚¨ãƒ©ãƒ¼ãŒã‚ã£ã¦ã‚‚è¨˜éŒ²ä½œæˆã¯æˆåŠŸã¨ã™ã‚‹ï¼‰
    getCurrentWeather('Tokyo')
      .then(async (weatherData) => {
        if (weatherData) {
          await WeatherDataModel.create(
            userId,
            weatherData.temperature,
            weatherData.humidity,
            weatherData.weatherCondition,
            weatherData.location
          );
          console.log('Weather data saved successfully');
        }
      })
      .catch((error) => {
        console.error('Failed to save weather data:', error);
      });
    
    res.status(201).json({
      success: true,
      data: record,
      message: 'è¨˜éŒ²ã‚’ä½œæˆã—ã¾ã—ãŸ'
    });
  } catch (error) {
    console.error('è¨˜éŒ²ä½œæˆã‚¨ãƒ©ãƒ¼:', error);
    res.status(500).json({
      success: false,
      message: 'è¨˜éŒ²ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ'
    });
  }
}
```

**å®Ÿè£…ã®ç‰¹å¾´**:
- è¨˜éŒ²ä½œæˆå¾Œã€Promise ã® then/catch ã§æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã‚’éåŒæœŸä¿å­˜
- æ°—è±¡APIéšœå®³æ™‚ã‚‚è¨˜éŒ²ä½œæˆã«å½±éŸ¿ã—ãªã„è¨­è¨ˆ
- ä½ç½®æƒ…å ±ã¯ 'Tokyo' ã§å›ºå®šï¼ˆä»Šå¾Œã®æ”¹å–„å€™è£œï¼‰

**weatherController.ts - ç¾åœ¨ã®æ°—è±¡ãƒ‡ãƒ¼ã‚¿å–å¾—ã®å®Ÿè£…**:
```typescript
export async function getCurrentWeatherData(req: Request, res: Response): Promise<void> {
  try {
    const city = req.query.city as string || 'Tokyo';

    const weatherData = await getCurrentWeather(city);

    if (!weatherData) {
      res.status(500).json({
        success: false,
        message: 'æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ'
      });
      return;
    }

    res.json({
      success: true,
      data: {
        temperature: weatherData.temperature,
        humidity: weatherData.humidity,
        weatherCondition: weatherData.weatherCondition,
        location: weatherData.location
      }
    });
  } catch (error) {
    console.error('Weather data error:', error);
    res.status(500).json({
      success: false,
      message: 'æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ'
    });
  }
}
```

**å®Ÿè£…ã®ç‰¹å¾´**:
- ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ city ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ 'Tokyo'
- weatherService.getCurrentWeather() ã‚’å‘¼ã³å‡ºã—
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè£…æ¸ˆã¿

---

#### 6.2.6 ã‚µãƒ¼ãƒ“ã‚¹å±¤

å¤–éƒ¨APIã¨ã®é€£æºãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã€‚

**weatherService.ts** âœ… å®Ÿè£…ç¢ºèªæ¸ˆã¿:
```typescript
export async function getCurrentWeather(city: string = 'Tokyo'): Promise<WeatherData | null> {
  try {
    if (!WEATHER_API_KEY) {
      console.error('Weather API key is not configured');
      return null;
    }

    const response = await axios.get<WeatherApiResponse>(`${WEATHER_API_URL}/current.json`, {
      params: {
        key: WEATHER_API_KEY,
        q: city,
        aqi: 'no'
      }
    });

    const data = response.data;

    return {
      temperature: data.current.temp_c,
      humidity: data.current.humidity,
      weatherCondition: data.current.condition.text,
      location: `${data.location.name}, ${data.location.country}`
    };
  } catch (error) {
    console.error('Weather API error:', error);
    return null;
  }
}
```

**å®Ÿè£…ã®ç‰¹å¾´**:
- WeatherAPI ã® /current.json ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½¿ç”¨
- æ°—æ¸©ã€æ¹¿åº¦ã€å¤©æ°—ã®çŠ¶æ…‹ã€ä½ç½®æƒ…å ±ã‚’å–å¾—
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†

**aiService.tsï¼ˆä»Šå¾Œå®Ÿè£…äºˆå®šï¼‰**:
- generateQuestions(): AIè³ªå•ç”Ÿæˆ
- analyzeData(): ãƒ‡ãƒ¼ã‚¿åˆ†æ
- generateAdvice(): ã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”Ÿæˆ

---

### 6.3 ç’°å¢ƒå¤‰æ•°

**.env ãƒ•ã‚¡ã‚¤ãƒ«**:
```env
# Database
DB_HOST=localhost
DB_PORT=5432
DB_NAME=mood_tracker_db
DB_USER=postgres
DB_PASSWORD=your_password

# Server
PORT=3000

# JWT
JWT_SECRET=your_jwt_secret_key_here

# Weather API
WEATHER_API_KEY=your_weather_api_key
WEATHER_API_URL=https://api.weatherapi.com/v1

# AI API (äºˆå®š)
GEMINI_API_KEY=your_gemini_api_key
```

---

## 7. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æ§‹é€ 

### 7.1 ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
mood-tracker-app/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ Layout/
â”‚   â”‚   â”‚   â”œâ”€â”€ Layout.tsx         # ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx        # ã‚µã‚¤ãƒ‰ãƒãƒ¼
â”‚   â”‚   â”‚   â””â”€â”€ Layout.css
â”‚   â”‚   â”œâ”€â”€ Dashboard/
â”‚   â”‚   â”‚   â”œâ”€â”€ Dashboard.tsx      # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
â”‚   â”‚   â”‚   â”œâ”€â”€ MoodChart.tsx      # æ°—åˆ†ã‚°ãƒ©ãƒ•
â”‚   â”‚   â”‚   â”œâ”€â”€ WeatherChart.tsx   # æ°—è±¡ã‚°ãƒ©ãƒ•
â”‚   â”‚   â”‚   â””â”€â”€ Dashboard.css
â”‚   â”‚   â”œâ”€â”€ Record/
â”‚   â”‚   â”‚   â”œâ”€â”€ RecordForm.tsx     # è¨˜éŒ²å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  âœ… æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºå®Ÿè£…æ¸ˆã¿
â”‚   â”‚   â”‚   â”œâ”€â”€ RecordList.tsx     # è¨˜éŒ²ä¸€è¦§
â”‚   â”‚   â”‚   â”œâ”€â”€ RecordDetail.tsx   # è¨˜éŒ²è©³ç´° âš ï¸ æ°—è±¡ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºæœªå®Œæˆ
â”‚   â”‚   â”‚   â””â”€â”€ RecordForm.css
â”‚   â”‚   â””â”€â”€ Auth/
â”‚   â”‚       â”œâ”€â”€ Login.tsx          # ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢
â”‚   â”‚       â”œâ”€â”€ Register.tsx       # ç™»éŒ²ç”»é¢
â”‚   â”‚       â””â”€â”€ Auth.css
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ api.ts                 # Axiosè¨­å®š
â”‚   â”‚   â”œâ”€â”€ authService.ts         # èªè¨¼ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚   â”œâ”€â”€ recordService.ts       # è¨˜éŒ²ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚   â””â”€â”€ weatherService.ts      # æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã‚µãƒ¼ãƒ“ã‚¹ âœ… getCurrentWeather å®Ÿè£…æ¸ˆã¿
â”‚   â”œâ”€â”€ contexts/
â”‚   â”‚   â””â”€â”€ AuthContext.tsx        # èªè¨¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â””â”€â”€ index.ts               # TypeScriptå‹å®šç¾©
â”‚   â”œâ”€â”€ App.tsx                    # ãƒ«ãƒ¼ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ App.css
â”‚   â””â”€â”€ main.tsx                   # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ public/
â”œâ”€â”€ index.html
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ vite.config.ts
```

### 7.2 ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

#### 7.2.1 èªè¨¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆAuthContext.tsxï¼‰

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã§èªè¨¼çŠ¶æ…‹ã‚’ç®¡ç†ã€‚

**æ©Ÿèƒ½**:
- ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã®ä¿æŒ
- ãƒˆãƒ¼ã‚¯ãƒ³ã®ç®¡ç†ï¼ˆlocalStorageã«ä¿å­˜ï¼‰
- ãƒ­ã‚°ã‚¤ãƒ³ãƒ»ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†
- è‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æ€§ãƒã‚§ãƒƒã‚¯ï¼‰

**æä¾›ã™ã‚‹å€¤**:
- user: ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
- token: JWTãƒˆãƒ¼ã‚¯ãƒ³
- login(): ãƒ­ã‚°ã‚¤ãƒ³é–¢æ•°
- logout(): ãƒ­ã‚°ã‚¢ã‚¦ãƒˆé–¢æ•°
- loading: ãƒ­ãƒ¼ãƒ‰ä¸­ãƒ•ãƒ©ã‚°

---

#### 7.2.2 ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆLayout.tsxï¼‰

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’æä¾›ã€‚

**æ§‹æˆ**:
- ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼ˆSidebarï¼‰
- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢
- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ

---

#### 7.2.3 ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼ˆSidebar.tsxï¼‰

ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’æä¾›ã€‚

**ãƒ¡ãƒ‹ãƒ¥ãƒ¼é …ç›®**:
- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
- ãƒ‡ãƒ¼ã‚¿ç™»éŒ²
- è¨˜éŒ²ä¸€è¦§
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆãƒ­ã‚°ã‚¢ã‚¦ãƒˆï¼‰

**æ©Ÿèƒ½**:
- ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã®è¦–è¦šçš„ãªãƒã‚¤ãƒ©ã‚¤ãƒˆ
- é–‹é–‰å¯èƒ½ãªã‚µã‚¤ãƒ‰ãƒãƒ¼
- ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤º

---

#### 7.2.4 ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆDashboard.tsxï¼‰

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’å¯è¦–åŒ–ã—ã¦è¡¨ç¤ºã€‚

**è¡¨ç¤ºå†…å®¹**:
1. **ã‚°ãƒ©ãƒ•ã‚»ã‚¯ã‚·ãƒ§ãƒ³**:
   - æ°—åˆ†ã¨ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã®æ¨ç§»ï¼ˆMoodChartï¼‰
   - æ°—æ¸©ã¨æ¹¿åº¦ã®æ¨ç§»ï¼ˆWeatherChartï¼‰

2. **çµ±è¨ˆãƒ‘ãƒãƒ«**:
   - ç·è¨˜éŒ²æ•°
   - ä»Šé€±ã®è¨˜éŒ²æ•°
   - å¹³å‡æ„Ÿæƒ…ã‚¹ã‚³ã‚¢
   - å¹³å‡ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³

3. **ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**:
   - æ–°ã—ã„è¨˜éŒ²ã®ä½œæˆ
   - è¨˜éŒ²ä¸€è¦§ã®è¡¨ç¤º

4. **æœ€è¿‘ã®è¨˜éŒ²**:
   - ç›´è¿‘5ä»¶ã®è¨˜éŒ²è¡¨ç¤º

---

#### 7.2.5 è¨˜éŒ²å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆRecordForm.tsxï¼‰ âœ… æ°—è±¡ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºå®Ÿè£…æ¸ˆã¿

æ–°ã—ã„è¨˜éŒ²ã‚’ä½œæˆã™ã‚‹ãƒ•ã‚©ãƒ¼ãƒ ã€‚

**å…¥åŠ›é …ç›®**:
- ç¡çœ æ™‚é–“ãƒ»ç¡çœ ã®è³ª
- é£Ÿäº‹ã®è³ªãƒ»é£Ÿäº‹ã®è¦å‰‡æ€§
- é‹å‹•æ™‚é–“ãƒ»é‹å‹•å¼·åº¦
- æ„Ÿæƒ…ã‚¹ã‚³ã‚¢ãƒ»æ„Ÿæƒ…ãƒ¡ãƒ¢
- ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³
- ã‚„ã£ãŸã“ã¨

**æ©Ÿèƒ½**:
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- **æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã®è‡ªå‹•è¡¨ç¤º** âœ… å®Ÿè£…æ¸ˆã¿
  - weatherService.getCurrentWeather() ã‚’ä½¿ç”¨
  - æ°—è±¡æƒ…å ±ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºï¼ˆæ°—æ¸©ã€æ¹¿åº¦ã€å¤©æ°—ã€ä½ç½®æƒ…å ±ï¼‰
  - å¤©æ°—ã‚¢ã‚¤ã‚³ãƒ³ã®è‡ªå‹•é¸æŠ
- é€ä¿¡æ™‚ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
- æˆåŠŸãƒ»ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¡¨ç¤º

**å®Ÿè£…è©³ç´°**:
```typescript
const loadWeather = async () => {
  try {
    setWeatherLoading(true);
    const data = await getCurrentWeather();
    setWeather(data);
  } catch (error) {
    console.error('Weather load error:', error);
  } finally {
    setWeatherLoading(false);
  }
};

useEffect(() => {
  loadWeather();
}, []);
```

**æ°—è±¡æƒ…å ±ã‚«ãƒ¼ãƒ‰**:
```jsx
{weather ? (
  <div className="weather-info-card">
    <div className="weather-icon-large">
      {getWeatherIcon(weather.weatherCondition)}
    </div>
    <div className="weather-details">
      <div className="weather-location">{weather.location}</div>
      <div className="weather-condition">{weather.weatherCondition}</div>
      <div className="weather-metrics">
        <span className="weather-metric">ğŸŒ¡ï¸ {weather.temperature}Â°C</span>
        <span className="weather-metric">ğŸ’§ {weather.humidity}%</span>
      </div>
    </div>
  </div>
) : null}
```

---

#### 7.2.6 è¨˜éŒ²ä¸€è¦§ï¼ˆRecordList.tsxï¼‰

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¨˜éŒ²ã‚’ä¸€è¦§è¡¨ç¤ºã€‚

**è¡¨ç¤ºå†…å®¹**:
- è¨˜éŒ²æ—¥æ™‚
- æ„Ÿæƒ…ã‚¹ã‚³ã‚¢
- ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³
- ç¡çœ ãƒ»é‹å‹•ãƒ»é£Ÿäº‹ã®ã‚µãƒãƒªãƒ¼

**æ©Ÿèƒ½**:
- ã‚«ãƒ¼ãƒ‰å½¢å¼ã§ã®è¡¨ç¤º
- è©³ç´°ç”»é¢ã¸ã®é·ç§»
- æ—¥ä»˜ã§ã®ã‚½ãƒ¼ãƒˆ

---

#### 7.2.7 è¨˜éŒ²è©³ç´°ï¼ˆRecordDetail.tsxï¼‰ âš ï¸ æ°—è±¡ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºæœªå®Œæˆ

ç‰¹å®šã®è¨˜éŒ²ã®è©³ç´°ã‚’è¡¨ç¤ºã€‚

**è¡¨ç¤ºå†…å®¹**:
- å…¨ã¦ã®è¨˜éŒ²ãƒ‡ãƒ¼ã‚¿
- ã‚¹ã‚³ã‚¢ã®ãƒãƒ¼å½¢å¼è¡¨ç¤º
- é–¢é€£ã™ã‚‹æ°—è±¡ãƒ‡ãƒ¼ã‚¿ï¼ˆTODOçŠ¶æ…‹ï¼‰

**æ©Ÿèƒ½**:
- è¨˜éŒ²ã®ç·¨é›†ï¼ˆäºˆå®šï¼‰
- è¨˜éŒ²ã®å‰Šé™¤
- ä¸€è¦§ã¸æˆ»ã‚‹

**å®Ÿè£…ã®å•é¡Œç‚¹**:
```typescript
const loadWeather = async () => {
  try {
    setWeatherLoading(true);
    // TODO: è¨˜éŒ²ã«ç´ã¥ãå¤©æ°—æƒ…å ±ã‚’å–å¾—ã™ã‚‹ã‚ˆã†ã«ä¿®æ­£
    // const data = await getCurrentWeather();
    // setWeather(data);
    setWeather(null);
  } catch (error) {
    console.error('Weather load error:', error);
  } finally {
    setWeatherLoading(false);
  }
};
```

**å•é¡Œã®æœ¬è³ª**:
- ç¾åœ¨ã¯ getCurrentWeather() ã‚’å‘¼ã³å‡ºã™å®Ÿè£…ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆæ¸ˆã¿ï¼‰
- æœ¬æ¥ã¯è¨˜éŒ²ã«ç´ã¥ãä¿å­˜æ¸ˆã¿æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã™ã¹ã
- weatherService ã«è¨˜éŒ²ç´ã¥ãå–å¾—é–¢æ•°ãŒæœªå®Ÿè£…

**å®Ÿè£…äºˆå®šã®ä¿®æ­£**:
```typescript
// weatherService.ts ã«è¿½åŠ äºˆå®š
export async function getWeatherByRecordId(recordId: number): Promise<CurrentWeather | null> {
  try {
    const response = await api.get<ApiResponse<CurrentWeather>>(`/api/weather/record/${recordId}`);
    if (response.data.success && response.data.data) {
      return response.data.data;
    }
    return null;
  } catch (error) {
    console.error('Weather fetch error:', error);
    return null;
  }
}

// RecordDetail.tsx ã®ä¿®æ­£äºˆå®š
const loadWeather = async () => {
  try {
    setWeatherLoading(true);
    const data = await getWeatherByRecordId(recordId);
    setWeather(data);
  } catch (error) {
    console.error('Weather load error:', error);
  } finally {
    setWeatherLoading(false);
  }
};
```

---

#### 7.2.8 ã‚°ãƒ©ãƒ•ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

**MoodChart.tsx**:
- Chart.jsã‚’ä½¿ç”¨ã—ãŸæŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•
- æ„Ÿæƒ…ã‚¹ã‚³ã‚¢ã¨ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã®æ¨ç§»è¡¨ç¤º
- éå»30æ—¥é–“ã®ãƒ‡ãƒ¼ã‚¿

**WeatherChart.tsx**:
- Chart.jsã‚’ä½¿ç”¨ã—ãŸè¤‡åˆã‚°ãƒ©ãƒ•
- æ°—æ¸©ï¼ˆæŠ˜ã‚Œç·šï¼‰ã¨æ¹¿åº¦ï¼ˆæ£’ï¼‰ã®è¡¨ç¤º
- éå»30æ—¥é–“ã®ãƒ‡ãƒ¼ã‚¿

---

### 7.3 ã‚µãƒ¼ãƒ“ã‚¹å±¤

#### 7.3.1 APIè¨­å®šï¼ˆapi.tsï¼‰

Axiosã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®è¨­å®šã¨ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã®å®Ÿè£…ã€‚

**æ©Ÿèƒ½**:
- ãƒ™ãƒ¼ã‚¹URLã®è¨­å®š
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³è‡ªå‹•ä»˜ä¸ï¼‰
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ï¼ˆã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼‰
- 401ã‚¨ãƒ©ãƒ¼æ™‚ã®è‡ªå‹•ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ

---

#### 7.3.2 èªè¨¼ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆauthService.tsï¼‰

èªè¨¼é–¢é€£ã®APIå‘¼ã³å‡ºã—ã‚’ç®¡ç†ã€‚

**é–¢æ•°**:
- register(): ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
- login(): ãƒ­ã‚°ã‚¤ãƒ³
- getCurrentUser(): ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—

---

#### 7.3.3 è¨˜éŒ²ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆrecordService.tsï¼‰

è¨˜éŒ²é–¢é€£ã®APIå‘¼ã³å‡ºã—ã‚’ç®¡ç†ã€‚

**é–¢æ•°**:
- getRecords(): è¨˜éŒ²ä¸€è¦§å–å¾—
- getRecordById(): ç‰¹å®šã®è¨˜éŒ²å–å¾—
- createRecord(): è¨˜éŒ²ä½œæˆ
- updateRecord(): è¨˜éŒ²æ›´æ–°
- deleteRecord(): è¨˜éŒ²å‰Šé™¤
- getRecordStats(): çµ±è¨ˆæƒ…å ±å–å¾—
- getChartData(): ã‚°ãƒ©ãƒ•ãƒ‡ãƒ¼ã‚¿å–å¾—

---

#### 7.3.4 æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆweatherService.tsï¼‰

æ°—è±¡ãƒ‡ãƒ¼ã‚¿é–¢é€£ã®APIå‘¼ã³å‡ºã—ã‚’ç®¡ç†ã€‚

**å®Ÿè£…æ¸ˆã¿é–¢æ•°**:
```typescript
export async function getCurrentWeather(): Promise<CurrentWeather | null> {
  try {
    const response = await api.get<ApiResponse<CurrentWeather>>('/api/weather/current');
    if (response.data.success && response.data.data) {
      return response.data.data;
    }
    return null;
  } catch (error) {
    console.error('Weather fetch error:', error);
    return null;
  }
}
```

**æœªå®Ÿè£…é–¢æ•°ï¼ˆTODOã‚³ãƒ¡ãƒ³ãƒˆã‚ã‚Šï¼‰**:
```typescript
// TODO: è¨˜éŒ²ã«ç´ã¥ãå¤©æ°—æƒ…å ±ã‚’å–å¾—ã™ã‚‹é–¢æ•°ã‚’è¿½åŠ 
```

**å®Ÿè£…äºˆå®š**:
```typescript
export async function getWeatherByRecordId(recordId: number): Promise<CurrentWeather | null> {
  try {
    const response = await api.get<ApiResponse<CurrentWeather>>(`/api/weather/record/${recordId}`);
    if (response.data.success && response.data.data) {
      return response.data.data;
    }
    return null;
  } catch (error) {
    console.error('Weather fetch error:', error);
    return null;
  }
}
```

---

### 7.4 å‹å®šç¾©

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§å…±é€šã®å‹å®šç¾©ã‚’ä½¿ç”¨ã€‚

**ä¸»è¦ãªå‹**:
- User: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
- Record: è¨˜éŒ²ãƒ‡ãƒ¼ã‚¿
- RecordInput: è¨˜éŒ²ä½œæˆæ™‚ã®å…¥åŠ›ãƒ‡ãƒ¼ã‚¿
- RecordStats: çµ±è¨ˆæƒ…å ±
- ChartData: ã‚°ãƒ©ãƒ•ãƒ‡ãƒ¼ã‚¿
- ApiResponse: APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ©ãƒƒãƒ‘ãƒ¼å‹
- CurrentWeather: ç¾åœ¨ã®æ°—è±¡ãƒ‡ãƒ¼ã‚¿

---

### 7.5 ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°

CSSãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¾ãŸã¯é€šå¸¸ã®CSSã‚’ä½¿ç”¨ã€‚

**ç‰¹å¾´**:
- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã”ã¨ã«ã‚¹ã‚¿ã‚¤ãƒ«ã‚’åˆ†é›¢
- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ï¼ˆãƒ¢ãƒã‚¤ãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆï¼‰
- ã‚«ãƒ©ãƒ¼ãƒ†ãƒ¼ãƒã®çµ±ä¸€
- ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®æ´»ç”¨

**ä¸»è¦ãªãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆ**:
- ãƒ¢ãƒã‚¤ãƒ«: 0ï½768px
- ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ: 769pxï½1024px
- ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—: 1025pxä»¥ä¸Š

---

## 8. èªè¨¼ãƒ»èªå¯

### 8.1 èªè¨¼ãƒ•ãƒ­ãƒ¼

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ•ãƒ­ãƒ¼

```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã«æƒ…å ±å…¥åŠ›
   â†“
2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãŒ /api/auth/register ã«POST
   â†“
3. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼åãƒ»ãƒ¡ãƒ¼ãƒ«ã®é‡è¤‡ãƒã‚§ãƒƒã‚¯
   â†“
4. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’bcryptã§ãƒãƒƒã‚·ãƒ¥åŒ–
   â†“
5. DBã«ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ä¿å­˜
   â†“
6. JWTãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆ
   â†“
7. ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã¨ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¿”å´
   â†“
8. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãŒãƒˆãƒ¼ã‚¯ãƒ³ã‚’localStorageã«ä¿å­˜
   â†“
9. è‡ªå‹•çš„ã«ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«é·ç§»
```

---

#### ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼

```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã«æƒ…å ±å…¥åŠ›
   â†“
2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãŒ /api/auth/login ã«POST
   â†“
3. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼åã§ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢
   â†“
4. bcryptã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æ¤œè¨¼
   â†“
5. æ¤œè¨¼æˆåŠŸ â†’ JWTãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆ
   â†“
6. ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã¨ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¿”å´
   â†“
7. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãŒãƒˆãƒ¼ã‚¯ãƒ³ã‚’localStorageã«ä¿å­˜
   â†“
8. è‡ªå‹•çš„ã«ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«é·ç§»
```

---

#### ä¿è­·ã•ã‚ŒãŸAPIã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ•ãƒ­ãƒ¼

```
1. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãŒAPIãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡
   â†“
2. Axiosã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ãŒè‡ªå‹•çš„ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä»˜ä¸
   Header: Authorization: Bearer {token}
   â†“
3. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ãŒãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¤œè¨¼
   â†“
4. æ¤œè¨¼æˆåŠŸ â†’ req.userã«ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’è¨­å®š
   â†“
5. ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†
   â†“
6. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”å´
```

---

### 8.2 JWTï¼ˆJSON Web Tokenï¼‰

#### ãƒˆãƒ¼ã‚¯ãƒ³ã®æ§‹æˆ

```
Header.Payload.Signature
```

**Payloadï¼ˆãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ï¼‰**:
```json
{
  "userId": 1,
  "username": "testuser",
  "iat": 1699000000,
  "exp": 1699604800
}
```

**æœ‰åŠ¹æœŸé™**: 7æ—¥é–“

---

#### ãƒˆãƒ¼ã‚¯ãƒ³ã®æ¤œè¨¼

1. ãƒˆãƒ¼ã‚¯ãƒ³ã®å½¢å¼ãƒã‚§ãƒƒã‚¯
2. ç½²åã®æ¤œè¨¼ï¼ˆJWT_SECRETã‚’ä½¿ç”¨ï¼‰
3. æœ‰åŠ¹æœŸé™ã®ãƒã‚§ãƒƒã‚¯
4. ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’æŠ½å‡º

---

### 8.3 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–

#### ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç®¡ç†

- **ãƒãƒƒã‚·ãƒ¥åŒ–**: bcryptã‚’ä½¿ç”¨ï¼ˆã‚½ãƒ«ãƒˆãƒ©ã‚¦ãƒ³ãƒ‰: 10ï¼‰
- **å¹³æ–‡ä¿å­˜ç¦æ­¢**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã¯ãƒãƒƒã‚·ãƒ¥å€¤ã®ã¿ä¿å­˜
- **æœ€å°æ–‡å­—æ•°**: 6æ–‡å­—ä»¥ä¸Š

---

#### ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†

- **ä¿å­˜å ´æ‰€**: localStorageï¼ˆXSSå¯¾ç­–ãŒå¿…è¦ï¼‰
- **è‡ªå‹•å‰Šé™¤**: ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ™‚ã€ãƒˆãƒ¼ã‚¯ãƒ³æœŸé™åˆ‡ã‚Œæ™‚
- **HTTPSæ¨å¥¨**: æœ¬ç•ªç’°å¢ƒã§ã¯å¿…é ˆ

---

#### APIä¿è­·

- **èªè¨¼å¿…é ˆ**: ã»ã¨ã‚“ã©ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§èªè¨¼ãŒå¿…è¦
- **CORSè¨­å®š**: è¨±å¯ã•ã‚ŒãŸã‚ªãƒªã‚¸ãƒ³ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- **ãƒ¬ãƒ¼ãƒˆåˆ¶é™**: ä»Šå¾Œå®Ÿè£…äºˆå®š

---

## 9. å¤–éƒ¨APIé€£æº

### 9.1 WeatherAPI

#### æ¦‚è¦

æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ãŸã‚ã®ç„¡æ–™APIã€‚

**å…¬å¼ã‚µã‚¤ãƒˆ**: https://www.weatherapi.com/

---

#### ä½¿ç”¨æ–¹æ³•

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**:
```
GET https://api.weatherapi.com/v1/current.json
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `key`: APIã‚­ãƒ¼
- `q`: éƒ½å¸‚åï¼ˆä¾‹: Tokyoï¼‰
- `aqi`: å¤§æ°—è³ªæƒ…å ±ï¼ˆnoï¼‰

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹**:
```json
{
  "location": {
    "name": "Tokyo",
    "country": "Japan"
  },
  "current": {
    "temp_c": 18.0,
    "condition": {
      "text": "Partly cloudy"
    },
    "humidity": 65,
    "pressure_mb": 1013.0
  }
}
```

---

#### å®Ÿè£… âœ… å®Ÿè£…ç¢ºèªæ¸ˆã¿

**weatherService.ts**:
```typescript
export async function getCurrentWeather(city: string = 'Tokyo'): Promise<WeatherData | null> {
  try {
    if (!WEATHER_API_KEY) {
      console.error('Weather API key is not configured');
      return null;
    }

    const response = await axios.get<WeatherApiResponse>(`${WEATHER_API_URL}/current.json`, {
      params: {
        key: WEATHER_API_KEY,
        q: city,
        aqi: 'no'
      }
    });

    const data = response.data;

    return {
      temperature: data.current.temp_c,
      humidity: data.current.humidity,
      weatherCondition: data.current.condition.text,
      location: `${data.location.name}, ${data.location.country}`
    };
  } catch (error) {
    console.error('Weather API error:', error);
    return null;
  }
}
```

---

#### ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã‚¿ã‚¤ãƒŸãƒ³ã‚° âœ… å®Ÿè£…ç¢ºèªæ¸ˆã¿

è¨˜éŒ²ä½œæˆæ™‚ã«è‡ªå‹•çš„ã«æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ãƒ»ä¿å­˜ã€‚

**å‡¦ç†ãƒ•ãƒ­ãƒ¼**:
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¨˜éŒ²ã‚’ä½œæˆ
2. RecordModel.create()ãŒè¨˜éŒ²ã‚’DBã«ä¿å­˜
3. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”å´
4. éåŒæœŸã§ getCurrentWeather('Tokyo') ã‚’å‘¼ã³å‡ºã—
5. å–å¾—ã—ãŸæ°—è±¡ãƒ‡ãƒ¼ã‚¿ã‚’ weather_data ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜
6. ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã‚‚è¨˜éŒ²ä½œæˆã«ã¯å½±éŸ¿ã—ãªã„

**å®Ÿè£…ã‚³ãƒ¼ãƒ‰ï¼ˆrecordController.tsï¼‰**:
```typescript
const record = await RecordModel.create(userId, recordData);

getCurrentWeather('Tokyo')
  .then(async (weatherData) => {
    if (weatherData) {
      await WeatherDataModel.create(
        userId,
        weatherData.temperature,
        weatherData.humidity,
        weatherData.weatherCondition,
        weatherData.location
      );
      console.log('Weather data saved successfully');
    }
  })
  .catch((error) => {
    console.error('Failed to save weather data:', error);
  });

res.status(201).json({...});
```

---

### 9.2 Google Gemini APIï¼ˆä»Šå¾Œå®Ÿè£…äºˆå®šï¼‰

#### æ¦‚è¦

AIã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿åˆ†æã¨ã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”Ÿæˆã«ä½¿ç”¨ã€‚

**ç”¨é€”**:
- è³ªå•ã®è‡ªå‹•ç”Ÿæˆ
- ãƒ‡ãƒ¼ã‚¿å‚¾å‘ã®åˆ†æ
- ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã•ã‚ŒãŸã‚¢ãƒ‰ãƒã‚¤ã‚¹ã®ç”Ÿæˆ

---

#### å®Ÿè£…äºˆå®šæ©Ÿèƒ½

**è³ªå•ç”Ÿæˆ**:
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‡ãƒ¼ã‚¿å‚¾å‘ã‹ã‚‰ä¸è¶³ã—ã¦ã„ã‚‹åˆ†æè¦³ç‚¹ã‚’ç‰¹å®š
- é©åˆ‡ãªè³ªå•ã‚’è‡ªå‹•ç”Ÿæˆ

**ãƒ‡ãƒ¼ã‚¿åˆ†æ**:
- éå»ã®ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å‚¾å‘ã‚’æŠ½å‡º
- èª¿å­ã®è‰¯ã„æ—¥ãƒ»æ‚ªã„æ—¥ã®ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ
- æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã¨ã®ç›¸é–¢åˆ†æ

**ã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”Ÿæˆ**:
- ç¾åœ¨ã®çŠ¶æ…‹ã«åŸºã¥ãã‚¢ãƒ‰ãƒã‚¤ã‚¹
- æ°—è±¡äºˆå ±ã‚’è€ƒæ…®ã—ãŸè¡Œå‹•ææ¡ˆ
- é•·æœŸçš„ãªæ”¹å–„ææ¡ˆ

---

## 10. ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### 10.1 è¨˜éŒ²ä½œæˆãƒ•ãƒ­ãƒ¼ âœ… æ°—è±¡ãƒ‡ãƒ¼ã‚¿è‡ªå‹•ä¿å­˜å®Ÿè£…æ¸ˆã¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ãƒ¦ãƒ¼ã‚¶ãƒ¼      â”‚
â”‚è¨˜éŒ²å…¥åŠ›      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚RecordForm    â”‚
â”‚(ãƒ•ãƒ­ãƒ³ãƒˆ)    â”‚
â”‚æ°—è±¡ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºâ”‚ âœ… å®Ÿè£…æ¸ˆã¿
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. POST /api/records
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚recordService â”‚
â”‚(APIå‘¼ã³å‡ºã—) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 3. HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆ
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Express Serverâ”‚
â”‚èªè¨¼MWâ†’æ¤œè¨¼MW â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 4. ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼å‘¼ã³å‡ºã—
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚recordControllerâ”‚
â”‚.createRecord()â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 5. ãƒ¢ãƒ‡ãƒ«å‘¼ã³å‡ºã—
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚RecordModel   â”‚
â”‚.create()     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 6. INSERTæ–‡å®Ÿè¡Œ
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚PostgreSQL    â”‚
â”‚recordsè¡¨     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 7. ä¿å­˜å®Œäº†ãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹è¿”å´
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                    â”‚
       â†“                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰â”‚            â”‚
â”‚æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
                            â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 8. éåŒæœŸã§æ°—è±¡ãƒ‡ãƒ¼ã‚¿å–å¾— âœ… å®Ÿè£…æ¸ˆã¿
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚weatherServiceâ”‚
â”‚.getCurrentWeather('Tokyo')â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 9. WeatherAPIå‘¼ã³å‡ºã—
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚WeatherAPI    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 10. æ°—è±¡ãƒ‡ãƒ¼ã‚¿å–å¾—
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚WeatherDataModelâ”‚
â”‚.create()     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 11. INSERTæ–‡å®Ÿè¡Œ
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚PostgreSQL    â”‚
â”‚weather_dataè¡¨â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 12. ä¿å­˜å®Œäº†ï¼ˆã‚¨ãƒ©ãƒ¼ã§ã‚‚è¨˜éŒ²ä½œæˆã«ã¯å½±éŸ¿ãªã—ï¼‰
       â†“
    å®Œäº†
```

**å®Ÿè£…ã®ç‰¹å¾´**:
- è¨˜éŒ²ä½œæˆã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹è¿”å´ã¯åŒæœŸçš„ã«å®Ÿè¡Œ
- æ°—è±¡ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»ä¿å­˜ã¯éåŒæœŸã§å®Ÿè¡Œï¼ˆPromise ã® then/catchï¼‰
- æ°—è±¡APIéšœå®³æ™‚ã‚‚è¨˜éŒ²ä½œæˆã«å½±éŸ¿ã—ãªã„è¨­è¨ˆ

---

### 10.2 ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤ºãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ãƒ¦ãƒ¼ã‚¶ãƒ¼      â”‚
â”‚ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰â”‚
â”‚ã‚¢ã‚¯ã‚»ã‚¹      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. ãƒšãƒ¼ã‚¸è¡¨ç¤º
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Dashboard     â”‚
â”‚(ãƒ•ãƒ­ãƒ³ãƒˆ)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. ãƒ‡ãƒ¼ã‚¿å–å¾—é–‹å§‹
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚          â”‚          â”‚
       â†“          â†“          â†“
  çµ±è¨ˆãƒ‡ãƒ¼ã‚¿   ã‚°ãƒ©ãƒ•ãƒ‡ãƒ¼ã‚¿  è¨˜éŒ²ä¸€è¦§
  GET /stats  GET /chart   GET /records
       â”‚          â”‚          â”‚
       â†“          â†“          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚RecordModel   â”‚ â”‚RecordModelâ”‚ â”‚RecordModelâ”‚
â”‚.getStats()   â”‚ â”‚.getChart..â”‚ â”‚.findBy...â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
       â”‚               â”‚            â”‚
       â”‚               â”‚            â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ 3. ãƒ‡ãƒ¼ã‚¿é›†ç´„
                       â†“
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚PostgreSQL    â”‚
               â”‚è¤‡æ•°ãƒ†ãƒ¼ãƒ–ãƒ«  â”‚
               â”‚çµåˆã‚¯ã‚¨ãƒª    â”‚
               â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â”‚ 4. ãƒ¬ã‚¹ãƒãƒ³ã‚¹è¿”å´
                      â†“
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚Dashboard     â”‚
               â”‚ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º    â”‚
               â”‚ã‚°ãƒ©ãƒ•æç”»    â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 10.3 è¨˜éŒ²è©³ç´°è¡¨ç¤ºãƒ•ãƒ­ãƒ¼ï¼ˆç¾çŠ¶ã¨å®Ÿè£…å¾Œï¼‰

#### ç¾çŠ¶ã®ãƒ•ãƒ­ãƒ¼ âš ï¸ æ°—è±¡ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºæœªå®Œæˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ãƒ¦ãƒ¼ã‚¶ãƒ¼      â”‚
â”‚è¨˜éŒ²è©³ç´°è¡¨ç¤º  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. è©³ç´°ç”»é¢ã‚¢ã‚¯ã‚»ã‚¹
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚RecordDetail  â”‚
â”‚(ãƒ•ãƒ­ãƒ³ãƒˆ)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. è¨˜éŒ²ãƒ‡ãƒ¼ã‚¿å–å¾—
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚recordService â”‚
â”‚.getRecordById()â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚GET /records/:idâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚è¨˜éŒ²ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 3. æ°—è±¡ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆTODOçŠ¶æ…‹ï¼‰
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚loadWeather() â”‚
â”‚setWeather(null)â”‚ âš ï¸ ä½•ã‚‚ã—ãªã„
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å®Ÿè£…å¾Œã®ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ãƒ¦ãƒ¼ã‚¶ãƒ¼      â”‚
â”‚è¨˜éŒ²è©³ç´°è¡¨ç¤º  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. è©³ç´°ç”»é¢ã‚¢ã‚¯ã‚»ã‚¹
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚RecordDetail  â”‚
â”‚(ãƒ•ãƒ­ãƒ³ãƒˆ)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                 â”‚                â”‚
       â”‚ 2. è¨˜éŒ²ãƒ‡ãƒ¼ã‚¿   â”‚ 3. æ°—è±¡ãƒ‡ãƒ¼ã‚¿  â”‚
       â”‚    å–å¾—         â”‚    å–å¾—        â”‚
       â†“                 â†“                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚recordService â”‚  â”‚weatherService   â”‚  â”‚
â”‚.getRecordById()  â”‚.getWeatherBy... â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
       â”‚                   â”‚            â”‚
       â†“                   â†“            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚GET /records/:id  â”‚GET /weather/    â”‚  â”‚
â”‚                â”‚  â”‚record/:recordId â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
       â”‚                   â”‚            â”‚
       â†“                   â†“            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚recordController  â”‚weatherControllerâ”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
       â”‚                   â”‚            â”‚
       â†“                   â†“            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚RecordModel   â”‚  â”‚RecordModel      â”‚  â”‚
â”‚.findById()   â”‚  â”‚.findById()      â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â†“              â”‚  â”‚
       â”‚          â”‚WeatherDataModel â”‚  â”‚
       â”‚          â”‚.getByUserAndDateâ”‚  â”‚
       â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
       â”‚                   â”‚            â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ 4. ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º
                       â†“
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚RecordDetail  â”‚
               â”‚è¨˜éŒ²+æ°—è±¡     â”‚
               â”‚ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º    â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®Ÿè£…äºˆå®šã®å‡¦ç†è©³ç´°**:
1. RecordDetail ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãƒã‚¦ãƒ³ãƒˆ
2. recordId ã‚’å…ƒã«è¨˜éŒ²ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
3. recordId ã‚’å…ƒã«æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
   - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: weatherService.getWeatherByRecordId(recordId)
   - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: GET /api/weather/record/:recordId
   - weatherController.getWeatherByRecordId()
     - RecordModel.findById() ã§è¨˜éŒ²ã® recorded_at ã‚’å–å¾—
     - WeatherDataModel.getByUserAndDate() ã§æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
     - æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã‚’è¿”å´
4. è¨˜éŒ²ãƒ‡ãƒ¼ã‚¿ã¨æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã‚’ç”»é¢ã«è¡¨ç¤º

---

### 10.4 èªè¨¼ãƒ•ãƒ­ãƒ¼è©³ç´°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. èªè¨¼æƒ…å ±é€ä¿¡
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚POST /api/authâ”‚
â”‚/login        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚UserModel     â”‚
â”‚.findByUsernameâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 3. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚bcrypt.compareâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 4. ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚jwt.sign()    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 5. ãƒˆãƒ¼ã‚¯ãƒ³è¿”å´
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰â”‚
â”‚localStorage  â”‚
â”‚ä¿å­˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 6. ä»¥é™ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Authorization:â”‚
â”‚Bearer token  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 7. ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚èªè¨¼MW        â”‚
â”‚jwt.verify()  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 8. ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 11. ä¸»è¦æ©Ÿèƒ½è©³ç´°

### 11.1 è¨˜éŒ²å…¥åŠ›æ©Ÿèƒ½

#### æ©Ÿèƒ½æ¦‚è¦
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ—¥ã€…ã®èª¿å­ã‚’è¨˜éŒ²ã™ã‚‹ãŸã‚ã®ãƒ•ã‚©ãƒ¼ãƒ æ©Ÿèƒ½ã€‚

#### å…¥åŠ›é …ç›®
1. **ç¡çœ **:
   - ç¡çœ æ™‚é–“ï¼ˆæ•°å€¤å…¥åŠ›ã€å°æ•°ç‚¹1æ¡ï¼‰
   - ç¡çœ ã®è³ªï¼ˆ1ï½10æ®µéšï¼‰

2. **é£Ÿäº‹**:
   - é£Ÿäº‹ã®è³ªï¼ˆ1ï½10æ®µéšï¼‰
   - é£Ÿäº‹ã®è¦å‰‡æ€§ï¼ˆ1ï½10æ®µéšï¼‰

3. **é‹å‹•**:
   - é‹å‹•æ™‚é–“ï¼ˆåˆ†å˜ä½ï¼‰
   - é‹å‹•å¼·åº¦ï¼ˆ1ï½10æ®µéšï¼‰

4. **æ„Ÿæƒ…**:
   - æ„Ÿæƒ…ã‚¹ã‚³ã‚¢ï¼ˆ1ï½10æ®µéšï¼‰
   - æ„Ÿæƒ…ãƒ¡ãƒ¢ï¼ˆè‡ªç”±è¨˜è¿°ï¼‰

5. **ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³**:
   - ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚³ã‚¢ï¼ˆ1ï½10æ®µéšï¼‰

6. **æ´»å‹•å†…å®¹**:
   - ã‚„ã£ãŸã“ã¨ï¼ˆè‡ªç”±è¨˜è¿°ï¼‰

#### ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«
- å…¨é …ç›®ãŒä»»æ„å…¥åŠ›ï¼ˆå°‘ãªãã¨ã‚‚1é …ç›®ã¯å…¥åŠ›å¿…é ˆï¼‰
- æ•°å€¤ã¯ç¯„å›²ãƒã‚§ãƒƒã‚¯ï¼ˆ1ï½10ï¼‰
- ç¡çœ æ™‚é–“ã¯0ï½24æ™‚é–“

#### è‡ªå‹•å‡¦ç†
- è¨˜éŒ²æ™‚åˆ»ã®è‡ªå‹•è¨­å®š
- **æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã®è‡ªå‹•å–å¾—ãƒ»ä¿å­˜** âœ… å®Ÿè£…æ¸ˆã¿
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®ä¿å­˜

#### æ°—è±¡ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º âœ… å®Ÿè£…æ¸ˆã¿
- è¨˜éŒ²ä½œæˆæ™‚ã«ç¾åœ¨ã®æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
- æ°—è±¡æƒ…å ±ã‚«ãƒ¼ãƒ‰ï¼ˆæ°—æ¸©ã€æ¹¿åº¦ã€å¤©æ°—ã€ä½ç½®æƒ…å ±ï¼‰
- å¤©æ°—ã‚¢ã‚¤ã‚³ãƒ³ã®è‡ªå‹•é¸æŠ

---

### 11.2 ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ©Ÿèƒ½

#### æ©Ÿèƒ½æ¦‚è¦
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¨˜éŒ²ãƒ‡ãƒ¼ã‚¿ã‚’å¯è¦–åŒ–ã—ã¦è¡¨ç¤ºã€‚

#### è¡¨ç¤ºã‚³ãƒ³ãƒ†ãƒ³ãƒ„

**1. ã‚°ãƒ©ãƒ•ã‚»ã‚¯ã‚·ãƒ§ãƒ³**:
- æ°—åˆ†ã¨ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã®æ¨ç§»ï¼ˆéå»30æ—¥ï¼‰
- æ°—æ¸©ã¨æ¹¿åº¦ã®æ¨ç§»ï¼ˆéå»30æ—¥ï¼‰
- Chart.jsã«ã‚ˆã‚‹æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ã¨è¤‡åˆã‚°ãƒ©ãƒ•

**2. çµ±è¨ˆãƒ‘ãƒãƒ«**:
- ç·è¨˜éŒ²æ•°
- ä»Šé€±ã®è¨˜éŒ²æ•°
- å¹³å‡æ„Ÿæƒ…ã‚¹ã‚³ã‚¢
- å¹³å‡ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³

**3. ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**:
- æ–°è¦è¨˜éŒ²ä½œæˆãƒœã‚¿ãƒ³
- è¨˜éŒ²ä¸€è¦§è¡¨ç¤ºãƒœã‚¿ãƒ³

**4. æœ€è¿‘ã®è¨˜éŒ²**:
- ç›´è¿‘5ä»¶ã®è¨˜éŒ²ã‚’ã‚«ãƒ¼ãƒ‰å½¢å¼ã§è¡¨ç¤º
- å„è¨˜éŒ²ã®ä¸»è¦ã‚¹ã‚³ã‚¢ã‚’è¡¨ç¤º
- ã‚¯ãƒªãƒƒã‚¯ã§è©³ç´°ç”»é¢ã«é·ç§»

#### ãƒ‡ãƒ¼ã‚¿æ›´æ–°
- ãƒšãƒ¼ã‚¸è¡¨ç¤ºæ™‚ã«è‡ªå‹•å–å¾—
- ãƒ‡ãƒ¼ã‚¿ä½œæˆãƒ»æ›´æ–°å¾Œã«ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥

---

### 11.3 è¨˜éŒ²ä¸€è¦§ãƒ»è©³ç´°æ©Ÿèƒ½

#### ä¸€è¦§ç”»é¢
- ã‚«ãƒ¼ãƒ‰å½¢å¼ã§ã®è¡¨ç¤º
- è¨˜éŒ²æ—¥æ™‚ã€æ„Ÿæƒ…ã€ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã€å„ç¨®ã‚¹ã‚³ã‚¢ã®ã‚µãƒãƒªãƒ¼è¡¨ç¤º
- æ—¥ä»˜é™é †ã§ã‚½ãƒ¼ãƒˆ
- ã‚«ãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯ã§è©³ç´°ç”»é¢ã«é·ç§»

#### è©³ç´°ç”»é¢ âš ï¸ æ°—è±¡ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºæœªå®Œæˆ
- å…¨ã¦ã®è¨˜éŒ²ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
- ã‚¹ã‚³ã‚¢ã‚’ãƒãƒ¼å½¢å¼ã§è¦–è¦šåŒ–
- **é–¢é€£ã™ã‚‹æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã®è¡¨ç¤ºï¼ˆTODOçŠ¶æ…‹ï¼‰**
  - ç¾åœ¨ã¯ getCurrentWeather() ã‚’å‘¼ã³å‡ºã™å®Ÿè£…ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆæ¸ˆã¿ï¼‰
  - æœ¬æ¥ã¯è¨˜éŒ²ã«ç´ã¥ãä¿å­˜æ¸ˆã¿æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã™ã¹ã
- ç·¨é›†ãƒ»å‰Šé™¤æ©Ÿèƒ½ï¼ˆäºˆå®šï¼‰
- ä¸€è¦§ã«æˆ»ã‚‹ãƒœã‚¿ãƒ³

---

### 11.4 è‡ªå·±åˆ†ææ©Ÿèƒ½ï¼ˆä»Šå¾Œå®Ÿè£…äºˆå®šï¼‰

#### è³ªå•è¡¨ç¤º
- åˆ†æè¦³ç‚¹ã”ã¨ã®è³ªå•ã‚’è¡¨ç¤º
- 10æ®µéšè©•ä¾¡ã§ã®å›ç­”
- AIç”Ÿæˆã®è³ªå•ã‚‚è¡¨ç¤ºå¯èƒ½

#### å›ç­”ä¿å­˜
- è¨˜éŒ²ã¨ç´ã¥ã‘ã¦ä¿å­˜
- è¨˜éŒ²ã¨ã¯ç‹¬ç«‹ã—ãŸå›ç­”ã‚‚å¯èƒ½

#### ãƒ‡ãƒ¼ã‚¿åˆ†æ
- å›ç­”ãƒ‡ãƒ¼ã‚¿ã®è“„ç©
- å‚¾å‘åˆ†æ
- ç›¸é–¢é–¢ä¿‚ã®æŠ½å‡º

---

### 11.5 ã‚¢ãƒ‰ãƒã‚¤ã‚¹æ©Ÿèƒ½ï¼ˆä»Šå¾Œå®Ÿè£…äºˆå®šï¼‰

#### ã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”Ÿæˆ
- AIã«ã‚ˆã‚‹è‡ªå‹•ç”Ÿæˆ
- ç¾åœ¨ã®çŠ¶æ…‹ã«åŸºã¥ãææ¡ˆ
- æ°—è±¡äºˆå ±ã‚’è€ƒæ…®ã—ãŸè¡Œå‹•ææ¡ˆ

#### è¡¨ç¤ºã‚¿ã‚¤ãƒŸãƒ³ã‚°
- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ä¸Šã«å¸¸æ™‚è¡¨ç¤º
- è¨˜éŒ²ä½œæˆå¾Œã«è¡¨ç¤º
- å®šæœŸçš„ãªæ›´æ–°

#### ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
- å½¹ç«‹ã£ãŸã‹ã®è©•ä¾¡
- AIã®æ”¹å–„ã«æ´»ç”¨

---

### 11.6 æ°—è±¡ãƒ‡ãƒ¼ã‚¿é€£æºæ©Ÿèƒ½ âœ… å®Ÿè£…ç¢ºèªæ¸ˆã¿

#### è‡ªå‹•å–å¾—
- è¨˜éŒ²ä½œæˆæ™‚ã«è‡ªå‹•å®Ÿè¡Œ
- WeatherAPIã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—
- éåŒæœŸå‡¦ç†ã§å®Ÿè¡Œï¼ˆãƒ¡ã‚¤ãƒ³å‡¦ç†ã«å½±éŸ¿ãªã—ï¼‰

#### ä¿å­˜ãƒ‡ãƒ¼ã‚¿
- æ°—æ¸©ã€æ¹¿åº¦
- å¤©æ°—ã®çŠ¶æ…‹
- ä½ç½®æƒ…å ±ï¼ˆ'Tokyo'å›ºå®šï¼‰

#### ãƒ‡ãƒ¼ã‚¿æ´»ç”¨
- ã‚°ãƒ©ãƒ•ã§ã®å¯è¦–åŒ–
- è¨˜éŒ²ã¨ã®ç›¸é–¢åˆ†æï¼ˆä»Šå¾Œå®Ÿè£…ï¼‰
- ã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”Ÿæˆæ™‚ã®è€ƒæ…®è¦ç´ ï¼ˆä»Šå¾Œå®Ÿè£…ï¼‰

#### ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³
- **è¨˜éŒ²ä½œæˆæ™‚ã®è‡ªå‹•ä¿å­˜**: âœ… å®Ÿè£…æ¸ˆã¿
- **ç¾åœ¨ã®æ°—è±¡ãƒ‡ãƒ¼ã‚¿å–å¾—API**: âœ… å®Ÿè£…æ¸ˆã¿
- **è¨˜éŒ²å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã§ã®è¡¨ç¤º**: âœ… å®Ÿè£…æ¸ˆã¿
- **è¨˜éŒ²è©³ç´°ç”»é¢ã§ã®è¡¨ç¤º**: âš ï¸ æœªå®Œæˆï¼ˆTODOçŠ¶æ…‹ï¼‰

---

## 12. å®Ÿè£…çŠ¶æ³ã¨èª²é¡Œ

### 12.1 å®Ÿè£…å®Œäº†æ©Ÿèƒ½

#### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
1. âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã‚·ã‚¹ãƒ†ãƒ 
2. âœ… è¨˜éŒ²ç®¡ç†æ©Ÿèƒ½ï¼ˆCRUDæ“ä½œã€çµ±è¨ˆã€ã‚°ãƒ©ãƒ•ãƒ‡ãƒ¼ã‚¿ï¼‰
3. âœ… æ°—è±¡ãƒ‡ãƒ¼ã‚¿é€£æº
   - WeatherAPI ã‹ã‚‰ã®è‡ªå‹•å–å¾—
   - è¨˜éŒ²ä½œæˆæ™‚ã®è‡ªå‹•ä¿å­˜ï¼ˆéåŒæœŸï¼‰
   - ç¾åœ¨ã®æ°—è±¡ãƒ‡ãƒ¼ã‚¿å–å¾—API
   - WeatherDataModel å®Ÿè£…ï¼ˆcreate, getByUserAndDateï¼‰

#### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
1. âœ… èªè¨¼ç”»é¢ï¼ˆãƒ­ã‚°ã‚¤ãƒ³ãƒ»ç™»éŒ²ï¼‰
2. âœ… ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆçµ±è¨ˆã€ã‚°ãƒ©ãƒ•ã€æœ€è¿‘ã®è¨˜éŒ²ï¼‰
3. âœ… è¨˜éŒ²å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆæ°—è±¡ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºå«ã‚€ï¼‰
4. âœ… è¨˜éŒ²ä¸€è¦§
5. âš ï¸ è¨˜éŒ²è©³ç´°ï¼ˆæ°—è±¡ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºæœªå®Œæˆï¼‰
6. âœ… ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã‚µã‚¤ãƒ‰ãƒãƒ¼ã€ãƒšãƒ¼ã‚¸é·ç§»ï¼‰

---

### 12.2 å®Ÿè£…èª²é¡Œ

#### æœ€å„ªå…ˆå®Ÿè£…èª²é¡Œ

**1. è¨˜éŒ²è©³ç´°ç”»é¢ã®æ°—è±¡ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºæ©Ÿèƒ½ã®å®Œæˆ**

**ç¾çŠ¶**:
- RecordDetail.tsx ã§ loadWeather() ãŒã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆçŠ¶æ…‹
- weatherService ã«è¨˜éŒ²ç´ã¥ãå–å¾—é–¢æ•°ãŒæœªå®Ÿè£…
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«è©²å½“APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒæœªå®Ÿè£…

**å¿…è¦ãªå®Ÿè£…**:

**ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**:
```typescript
// weatherController.ts ã«è¿½åŠ 
export async function getWeatherByRecordId(req: Request, res: Response): Promise<void> {
  try {
    const userId = req.user?.userId;
    const recordId = parseInt(req.params.recordId);

    if (!userId) {
      res.status(401).json({ success: false, message: 'èªè¨¼ãŒå¿…è¦ã§ã™' });
      return;
    }

    // è¨˜éŒ²ã‚’å–å¾—
    const record = await RecordModel.findById(recordId, userId);
    if (!record) {
      res.status(404).json({ success: false, message: 'è¨˜éŒ²ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ' });
      return;
    }

    // è¨˜éŒ²æ—¥æ™‚ã®æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    const weatherData = await WeatherDataModel.getByUserAndDate(userId, new Date(record.recorded_at));

    if (!weatherData) {
      res.status(404).json({ success: false, message: 'æ°—è±¡ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ' });
      return;
    }

    res.json({
      success: true,
      data: {
        temperature: weatherData.temperature,
        humidity: weatherData.humidity,
        weatherCondition: weatherData.weather_condition,
        location: weatherData.location
      }
    });
  } catch (error) {
    console.error('Weather data error:', error);
    res.status(500).json({ success: false, message: 'æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ' });
  }
}

// weatherRoutes.ts ã«è¿½åŠ 
router.get('/record/:recordId', getWeatherByRecordId);
```

**ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**:
```typescript
// weatherService.ts ã«è¿½åŠ 
export async function getWeatherByRecordId(recordId: number): Promise<CurrentWeather | null> {
  try {
    const response = await api.get<ApiResponse<CurrentWeather>>(`/api/weather/record/${recordId}`);
    if (response.data.success && response.data.data) {
      return response.data.data;
    }
    return null;
  } catch (error) {
    console.error('Weather fetch error:', error);
    return null;
  }
}

// RecordDetail.tsx ã®ä¿®æ­£
const loadWeather = async () => {
  try {
    setWeatherLoading(true);
    const data = await getWeatherByRecordId(recordId);
    setWeather(data);
  } catch (error) {
    console.error('Weather load error:', error);
  } finally {
    setWeatherLoading(false);
  }
};
```

**å®Ÿè£…æ™‚é–“ç›®å®‰**: 30ï½45åˆ†

---

#### ãã®ä»–ã®èª²é¡Œ

**2. ä½ç½®æƒ…å ±ã®å‹•çš„å–å¾—**
- ç¾åœ¨ã¯ 'Tokyo' å›ºå®š
- ãƒ–ãƒ©ã‚¦ã‚¶ã®Geolocation APIã‚’ä½¿ç”¨
- ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šã«ã‚ˆã‚‹ä½ç½®æƒ…å ±ç®¡ç†

**3. è‡ªå·±åˆ†ææ©Ÿèƒ½ã®å®Ÿè£…**
- è³ªå•è¡¨ç¤ºç”»é¢
- å›ç­”ä¿å­˜æ©Ÿèƒ½
- ãƒ‡ãƒ¼ã‚¿åˆ†æåŸºç›¤

**4. AIåˆ†æãƒ»ã‚¢ãƒ‰ãƒã‚¤ã‚¹æ©Ÿèƒ½ã®å®Ÿè£…**
- Gemini APIé€£æº
- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­è¨ˆ
- ã‚¢ãƒ‰ãƒã‚¤ã‚¹è¡¨ç¤ºUI

**5. è¨˜éŒ²ç·¨é›†æ©Ÿèƒ½ã®è¿½åŠ **
- ç·¨é›†ç”»é¢å®Ÿè£…
- æ›´æ–°APIå®Œæˆ

---

### 12.3 ä»Šå¾Œã®æ‹¡å¼µäºˆå®š

#### çŸ­æœŸçš„ãªå®Ÿè£…äºˆå®š
1. è¨˜éŒ²è©³ç´°ç”»é¢ã®æ°—è±¡ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºæ©Ÿèƒ½ã‚’å®Œæˆã•ã›ã‚‹ï¼ˆæœ€å„ªå…ˆï¼‰
2. è‡ªå·±åˆ†æè³ªå•æ©Ÿèƒ½ã®å®Œå…¨å®Ÿè£…
3. ã‚¢ãƒ‰ãƒã‚¤ã‚¹æ©Ÿèƒ½ã®å®Ÿè£…
4. è¨˜éŒ²ã®ç·¨é›†æ©Ÿèƒ½

#### ä¸­æœŸçš„ãªå®Ÿè£…äºˆå®š
1. é€šçŸ¥æ©Ÿèƒ½
2. ã‚°ãƒ©ãƒ•ã®å¼·åŒ–
3. ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½
4. ç›®æ¨™è¨­å®šæ©Ÿèƒ½

#### é•·æœŸçš„ãªå®Ÿè£…äºˆå®š
1. ã‚½ãƒ¼ã‚·ãƒ£ãƒ«æ©Ÿèƒ½
2. ã‚¦ã‚§ã‚¢ãƒ©ãƒ–ãƒ«ãƒ‡ãƒã‚¤ã‚¹é€£æº
3. AIç²¾åº¦å‘ä¸Š
4. å¤šè¨€èªå¯¾å¿œ

---

## 13. ã¾ã¨ã‚

æœ¬ã‚·ã‚¹ãƒ†ãƒ ã¯ã€React + TypeScript ã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ Node.js + Express + PostgreSQL ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§æ§‹æˆã•ã‚Œã‚‹ã€AIã‚’æ´»ç”¨ã—ãŸèª¿å­è¨˜éŒ²Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚ã‚‹ã€‚

**ä¸»è¦ãªç‰¹å¾´**:
- JWTèªè¨¼ã«ã‚ˆã‚‹å®‰å…¨ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
- RESTful APIã«ã‚ˆã‚‹æ˜ç¢ºãªè²¬ä»»åˆ†é›¢
- PostgreSQLã«ã‚ˆã‚‹å …ç‰¢ãªãƒ‡ãƒ¼ã‚¿ç®¡ç†
- Chart.jsã«ã‚ˆã‚‹ç›´æ„Ÿçš„ãªãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–
- å¤–éƒ¨APIã¨ã®é€£æºï¼ˆæ°—è±¡ãƒ‡ãƒ¼ã‚¿ã€AIåˆ†æï¼‰
- ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ
- **æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã®è‡ªå‹•å–å¾—ãƒ»ä¿å­˜æ©Ÿèƒ½** âœ… å®Ÿè£…æ¸ˆã¿

**æŠ€è¡“çš„ãªå¼·ã¿**:
- TypeScriptã«ã‚ˆã‚‹å‹å®‰å…¨æ€§
- MVCãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚‹ä¿å®ˆæ€§ã®é«˜ã„è¨­è¨ˆ
- éåŒæœŸå‡¦ç†ã«ã‚ˆã‚‹é«˜ã„ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ã«ã‚ˆã‚‹ãƒãƒ«ãƒãƒ‡ãƒã‚¤ã‚¹å¯¾å¿œ

**ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³**:
- ã»ã¨ã‚“ã©ã®ä¸»è¦æ©Ÿèƒ½ã¯å®Ÿè£…å®Œäº†
- æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã®è‡ªå‹•ä¿å­˜ã¯æ­£å¸¸ã«å‹•ä½œ
- è¨˜éŒ²è©³ç´°ç”»é¢ã®æ°—è±¡ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºãŒæœªå®Œæˆï¼ˆæœ€å„ªå…ˆèª²é¡Œï¼‰

æœ¬å®šç¾©æ›¸ã¯ã€ã‚·ã‚¹ãƒ†ãƒ ã®å…¨ä½“åƒã‚’ç†è§£ã—ã€ä»Šå¾Œã®é–‹ç™ºã‚„ä¿å®ˆã‚’å††æ»‘ã«é€²ã‚ã‚‹ãŸã‚ã®åŸºç¤è³‡æ–™ã¨ã—ã¦æ´»ç”¨ã•ã‚Œã‚‹ã“ã¨ã‚’æƒ³å®šã—ã¦ã„ã‚‹ã€‚

---

**æ–‡æ›¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 2.0  
**ä½œæˆæ—¥**: 2025å¹´11æœˆ7æ—¥  
**æœ€çµ‚æ›´æ–°æ—¥**: 2025å¹´11æœˆ21æ—¥  
**æ›´æ–°å†…å®¹**: æ°—è±¡ãƒ‡ãƒ¼ã‚¿é€£æºæ©Ÿèƒ½ã®å®Ÿè£…çŠ¶æ³ã‚’åæ˜ ã€è¨˜éŒ²è©³ç´°ç”»é¢ã®èª²é¡Œã‚’æ˜è¨˜
